(this["webpackJsonp@minimal/minimal-kit-react"]=this["webpackJsonp@minimal/minimal-kit-react"]||[]).push([[83],{1827:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return F}));var i=n(9),a=n(6),l=n(18),c=n(3),d=n.n(c),o=n(1398),r=n(1406),s=n(133),u=n(145),m=n(1491),p=n(1466),v=n(286),j=n(1513),b=n(1514),h=n(1482),f=n(1501),O=n(701),y=n(1414),x=n(118),k=n(4),T=n(68),g=n(49),D=n(1844),C=n(69),w=n.n(C),E=n(52),I=n(72),W=n(134),z=n(0);function F(e){var t,n,c,C=e.selectedCompany,F=e.operationType,P=e.updatedEvent,U=e.set_updatedEvent,q=e.open,L=e.onCancel,S=e.fetchEventDateRange,A=e.fetchEmployee,M=e.employeesList,Y=e.us_fromDate,_=e.us_ToDate,J=Object(I.a)().user,N=Object(x.b)().enqueueSnackbar,Z=Object(E.b)(),R=Object(k.useState)(""),B=Object(l.a)(R,2),G=B[0],H=B[1],K=Object(k.useState)({eventId:"update"===F?null===P||void 0===P?void 0:P.eventId:"",date:"update"===F?null===P||void 0===P?void 0:P.date:new Date,title:"update"===F?null===P||void 0===P?void 0:P.titleField:"",description:"update"===F?null===P||void 0===P?void 0:P.description:"",startTime:"update"===F?null===P||void 0===P?void 0:P.startTime:"00:00",endTime:"update"===F?null===P||void 0===P?void 0:P.endTime:"00:00",employees:"update"===F?null===P||void 0===P?void 0:P.employees:[],eventColor:"update"===F?null!==P&&void 0!==P&&P.linkedDocumentType&&"invoice"===(null===P||void 0===P?void 0:P.linkedDocumentType)?"#54D62C":null!==P&&void 0!==P&&P.linkedDocumentType&&"proforma"===(null===P||void 0===P?void 0:P.linkedDocumentType)?"#FF4842":"":"",editedUser:"update"===F?null===P||void 0===P?void 0:P.editedUser:"",linkedDocumentType:"update"===F?null===P||void 0===P?void 0:P.linkedDocumentType:""}),Q=Object(l.a)(K,2),V=Q[0],X=Q[1],$=V.date,ee=V.title,te=V.description,ne=V.startTime,ie=V.endTime,ae=V.employees,le=V.eventColor,ce=V.editedUser,de=V.linkedDocumentType;function oe(){return(oe=Object(a.a)(d.a.mark((function e(){var t,n,i,a,l,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ee&&$&&ne&&ie&&"00:00"!==ne&&"00:00"!==ie&&ae&&0!==(null===ae||void 0===ae?void 0:ae.length)){e.next=4;break}N("Title, date, time and employees fields are compulsory",{variant:"warning"}),e.next=23;break;case 4:if(Z(Object(T.d)(!0)),t=w()($).format("YYYY-MM-DD"),n="".concat(t,"T").concat(ne,":00Z"),i="".concat(t,"T").concat(ie,":00Z"),a="",ae.forEach((function(e){a=a+(null===e||void 0===e?void 0:e.name)+", "})),l="Title: ".concat(ee),c=te,te&&(l+=" - Description: ".concat(te)),a&&(l+=" - Assigned employees: ".concat(a)),l+=" - Start time: ".concat(ne," - End time: ").concat(ie),!F||"create"!==F){e.next=20;break}return e.next=18,g.b.collection("company").doc(C.id).collection("calendar").add({title:l,titleField:ee,start:n,end:i,allDay:!1,description:c,employees:ae,eventColor:le,linkedDocumentType:de,editedUser:null===J||void 0===J?void 0:J.email,firebaseDateTimestamp:W.a.firestore.Timestamp.fromDate(new Date(t))}).then((function(){X({date:new Date,title:"",description:"",startTime:"00:00",endTime:"00:00",employees:[],eventColor:"",linkedDocumentType:""}),S(C.id,Y,_),N("Details saved successfully"),Z(Object(T.d)(!1)),L()})).catch((function(e){N("Error occured while saving details: ".concat(null===e||void 0===e?void 0:e.message),{variant:"error"}),Z(Object(T.d)(!1))}));case 18:e.next=23;break;case 20:if("update"!==F||""===(null===P||void 0===P?void 0:P.publicId)){e.next=23;break}return e.next=23,g.b.collection("company").doc(C.id).collection("calendar").doc(null===P||void 0===P?void 0:P.publicId).set({title:l,titleField:ee,start:n,end:i,allDay:!1,description:c,employees:ae,eventColor:le,linkedDocumentType:de,editedUser:null===J||void 0===J?void 0:J.email,firebaseDateTimestamp:W.a.firestore.Timestamp.fromDate(new Date(t))},{merge:!0}).then((function(){X({date:new Date,title:"",description:"",startTime:"00:00",endTime:"00:00",employees:[],eventColor:"",linkedDocumentType:""}),U(null),S(C.id,Y,_),N("Details saved successfully"),Z(Object(T.d)(!1)),L()})).catch((function(e){N("Error occured while saving details: ".concat(null===e||void 0===e?void 0:e.message),{variant:"error"}),Z(Object(T.d)(!1))}));case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function re(){return(re=Object(a.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!G){e.next=6;break}return Z(Object(T.d)(!0)),e.next=4,g.b.collection("company").doc(C.id).collection("employee").add({name:G}).then((function(){H(""),A(),N("Employee saved successfully"),Z(Object(T.d)(!1))})).catch((function(e){N("Error occured while saving employee name: ".concat(null===e||void 0===e?void 0:e.message),{variant:"error"}),Z(Object(T.d)(!1))}));case 4:e.next=7;break;case 6:N("Please provide an employee name",{variant:"warning"});case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(z.jsxs)(o.a,{open:q,onClose:L,maxWidth:"sm",fullWidth:!0,children:[Object(z.jsx)(r.a,{children:F&&"create"===F?"Add task":F&&"update"===F?"Edit task":""}),Object(z.jsxs)(s.a,{container:!0,spacing:3,style:{padding:"1em"},children:[Object(z.jsx)(s.a,{item:!0,xs:12,md:12,children:Object(z.jsx)(u.a,{variant:"outlined",fullWidth:!0,name:"title",label:"Title",type:"text",id:"title",value:ee||"",size:"small",onChange:function(e){X((function(t){return Object(i.a)(Object(i.a)({},t),{},{title:e.target.value})}))},required:!0})}),Object(z.jsx)(s.a,{item:!0,xs:12,md:12,children:Object(z.jsx)(u.a,{variant:"outlined",fullWidth:!0,name:"description",label:"Description",type:"text",id:"description",value:te||"",multiline:!0,rows:4,size:"small",onChange:function(e){X((function(t){return Object(i.a)(Object(i.a)({},t),{},{description:e.target.value})}))}})}),"update"===F?Object(z.jsx)(s.a,{item:!0,xs:12,md:12,children:Object(z.jsx)(u.a,{variant:"outlined",fullWidth:!0,name:"editedUser",label:"User edited",type:"text",id:"editedUser",value:ce||"",size:"small",disabled:!0})}):"",Object(z.jsx)(s.a,{item:!0,xs:12,md:12,children:Object(z.jsx)(D.a,{label:"Date",value:$||"",onChange:function(e){X((function(t){return Object(i.a)(Object(i.a)({},t),{},{date:e})}))},inputFormat:"dd/MM/yyyy",renderInput:function(e){return Object(z.jsx)(u.a,Object(i.a)(Object(i.a)({},e),{},{size:"small"}))},style:{maxWidth:"500px"},required:!0})}),Object(z.jsx)(s.a,{item:!0,xs:12,md:6,children:Object(z.jsx)(u.a,{type:"time",label:"Start time",id:"startTime",name:"startTime",value:ne,InputLabelProps:{shrink:!0},variant:"outlined",onChange:function(e){X((function(t){return Object(i.a)(Object(i.a)({},t),{},{startTime:e.target.value})}))},size:"small",fullWidth:!0,required:!0})}),Object(z.jsx)(s.a,{item:!0,xs:12,md:6,children:Object(z.jsx)(u.a,{type:"time",label:"End time",id:"endTime",name:"endTime",value:ie,InputLabelProps:{shrink:!0},variant:"outlined",onChange:function(e){X((function(t){return Object(i.a)(Object(i.a)({},t),{},{endTime:e.target.value})}))},size:"small",fullWidth:!0,required:!0})}),Object(z.jsx)(s.a,{item:!0,xs:12,md:12,children:Object(z.jsx)(m.a,{multiple:!0,id:"tags-standard",options:M||[],getOptionLabel:function(e){return e.name},value:ae||null,renderInput:function(e){return Object(z.jsx)(u.a,Object(i.a)(Object(i.a)({},e),{},{variant:"outlined",label:"Assigned employees",placeholder:"Employees",size:"small"}))},onChange:function(e,t){X((function(e){return Object(i.a)(Object(i.a)({},e),{},{employees:t})}))},required:!0})}),Object(z.jsx)(s.a,{item:!0,xs:12,md:12,children:Object(z.jsxs)(p.a,{spacing:2,children:[Object(z.jsx)(v.a,{children:"Please choose if task is linked to proforma or invoice"}),Object(z.jsxs)(j.a,{size:"small",variant:"outlined",fullWidth:!0,margin:"normal",children:[Object(z.jsx)(b.a,{id:"linked-document-type",children:"Linked document type"}),Object(z.jsxs)(h.a,{label:"Linked document type",labelId:"linked-document-type",size:"small",placeholder:"Please choose a document type",value:de||"",onChange:function(e){var t=e.target.value,n="";"invoice"===t?n="#54D62C":"proforma"===t&&(n="#FF4842"),X((function(e){return Object(i.a)(Object(i.a)({},e),{},{linkedDocumentType:t,eventColor:n})}))},inputProps:{name:"linkedDocumentType",id:"linkedDocumentType"},children:[Object(z.jsx)(f.a,{value:"",children:"Please choose a document type *"}),Object(z.jsx)(f.a,{value:"invoice",children:"Invoice"}),Object(z.jsx)(f.a,{value:"proforma",children:"Proforma"})]})]})]})}),Object(z.jsx)(s.a,{item:!0,xs:12,md:12,children:Object(z.jsxs)(p.a,{spacing:3,direction:"row",alignItems:"center",children:[Object(z.jsx)(u.a,{variant:"outlined",fullWidth:!0,name:"employeeName",label:"Enter new employee name",type:"text",id:"employeeName",value:G||"",size:"small",onChange:function(e){H(e.target.value)}}),Object(z.jsx)(O.a,{variant:"contained",color:"primary",onClick:function(){return function(){return re.apply(this,arguments)}()},style:{whiteSpace:"nowrap",width:"300px"},disabled:!G,children:"Add employee"})]})})]}),Object(z.jsx)(y.a,{children:Object(z.jsxs)(s.a,{container:!0,spacing:3,children:[Object(z.jsx)(s.a,{item:!0,xs:12,md:6,children:Object(z.jsx)(O.a,{variant:"contained",color:"primary",onClick:function(){return function(){return oe.apply(this,arguments)}()},fullWidth:!0,disabled:"update"===F&&!(null!==J&&void 0!==J&&null!==(t=J.permissions)&&void 0!==t&&null!==(n=t.updateCalendarTask)&&void 0!==n&&null!==(c=n.assignedCompanyId)&&void 0!==c&&c.includes(null===C||void 0===C?void 0:C.id))||!ee||!$||!ne||!ie||"00:00"===ne||"00:00"===ie||!ae||0===(null===ae||void 0===ae?void 0:ae.length),children:"submit changes"})}),Object(z.jsx)(s.a,{item:!0,xs:12,md:6,children:Object(z.jsx)(O.a,{variant:"outlined",color:"error",onClick:L,fullWidth:!0,children:"Cancel"})})]})})]})}}}]);
//# sourceMappingURL=83.110de827.chunk.js.map