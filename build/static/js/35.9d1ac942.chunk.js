(this["webpackJsonp@minimal/minimal-kit-react"]=this["webpackJsonp@minimal/minimal-kit-react"]||[]).push([[35],{1552:function(e,t,n){"use strict";n.d(t,"a",(function(){return y}));var a=n(9),i=n(1844),c=n(133),o=n(286),r=n(1466),l=n(1492),d=n(1491),s=n(145),u=n(4),b=n(50),j=n.n(b),v=n(69),m=n.n(v),p=n(118),h=n(52),O=n(252),x=n(1565),g=n.n(x),f=n(0);function y(e){var t,n=e.product,b=e.callLocation,v=e.disableEditing,x=Object(h.b)(),y=Object(p.b)().enqueueSnackbar,k=n.name,w=n.price,D=Object(h.c)(O.b).bookingData;return Object(u.useEffect)((function(){if(null!==D&&void 0!==D&&D.bookingPickupDate&&null!==D&&void 0!==D&&D.bookingReturnDate&&m()(null===D||void 0===D?void 0:D.bookingReturnDate).format("YYYY-MM-DD")!==m()(new Date).format("YYYY-MM-DD")){var e=m()(null===D||void 0===D?void 0:D.bookingPickupDate,"YYYY-MM-DD"),t=m()(null===D||void 0===D?void 0:D.bookingReturnDate,"YYYY-MM-DD");if(t.isAfter(e)){var n=t.diff(e,"days")+1;x(Object(O.c)(Object(a.a)(Object(a.a)({},D),{},{bookingNumberOfDays:n})))}else y("Return date should be after Pickup date",{variant:"error"})}}),[null===D||void 0===D?void 0:D.bookingPickupDate,null===D||void 0===D?void 0:D.bookingReturnDate]),Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)(c.a,{item:!0,xs:12,md:12,children:Object(f.jsx)(o.a,{variant:"h4",sx:{mt:2,mb:1,display:"block"},children:k||""})}),Object(f.jsx)(c.a,{item:!0,xs:12,md:12,children:Object(f.jsxs)(r.a,{direction:"row",spacing:1,alignItems:"center",children:[Object(f.jsx)(l.a,{title:"Or similar models",children:Object(f.jsx)(g.a,{color:"info"})}),Object(f.jsx)(o.a,{children:"Or similar model"})]})}),Object(f.jsx)(c.a,{item:!0,xs:12,md:12,children:Object(f.jsxs)(o.a,{children:[Object(f.jsx)(j.a,{value:Number(w||0).toFixed(2),displayType:"text",thousandSeparator:!0,prefix:"".concat("\u20ac"," ")})," ","/ day"]})}),Object(f.jsx)(c.a,{item:!0,xs:12,md:12,children:Object(f.jsx)(d.a,{ListboxProps:{style:{maxHeight:"70vh"}},size:"small",label:"Pickup address",id:"pickup-drop-down",options:[{id:"ssr",title:"SSR Airport, Plaine Magnien, Mauritius"},{id:"anywhere",title:"Desired location - anywhere (+ additional cost)"}]||[],value:(null===D||void 0===D?void 0:D.bookingPickupAddress)||null,renderInput:function(e){return Object(f.jsx)(s.a,Object(a.a)(Object(a.a)({},e),{},{label:"Pickup address",InputLabelProps:{required:!0},size:"large"}))},required:!0,onChange:function(e,t,n){x("removeOption"!==n&&"clear"!==n&&t?Object(O.c)(Object(a.a)(Object(a.a)({},D),{},{bookingPickupAddress:t})):Object(O.c)(Object(a.a)(Object(a.a)({},D),{},{bookingPickupAddress:null})))},getOptionLabel:function(e){return e.title},disabled:"bookingList"===b&&v})}),"anywhere"===(null===D||void 0===D||null===(t=D.bookingPickupAddress)||void 0===t?void 0:t.id)&&Object(f.jsx)(c.a,{item:!0,xs:12,md:12,children:Object(f.jsx)(s.a,{variant:"outlined",fullWidth:!0,name:"bookingPickupAnywhereAddress",label:"Specify desired address",type:"text",id:"bookingPickupAnywhereAddress",value:(null===D||void 0===D?void 0:D.bookingPickupAnywhereAddress)||"",size:"large",onChange:function(e){x(Object(O.c)(Object(a.a)(Object(a.a)({},D),{},{bookingPickupAnywhereAddress:e.target.value})))},disabled:"bookingList"===b&&v})}),Object(f.jsx)(c.a,{item:!0,xs:12,md:6,children:Object(f.jsx)(i.a,{label:"Pickup date",value:(null===D||void 0===D?void 0:D.bookingPickupDate)||"",onChange:function(e){x(Object(O.c)(Object(a.a)(Object(a.a)({},D),{},{bookingPickupDate:e})))},renderInput:function(e){return Object(f.jsx)(s.a,Object(a.a)(Object(a.a)({},e),{},{size:"large",fullWidth:!0,disabled:"bookingList"===b&&v}))},inputFormat:"dd/MM/yyyy",disabled:"bookingList"===b&&v})}),Object(f.jsx)(c.a,{item:!0,xs:12,md:6,children:Object(f.jsx)(s.a,{variant:"outlined",fullWidth:!0,name:"bookingPickupTime",label:"Pickup time",type:"time",id:"bookingPickupTime",value:(null===D||void 0===D?void 0:D.bookingPickupTime)||"",size:"large",onChange:function(e){x(Object(O.c)(Object(a.a)(Object(a.a)({},D),{},{bookingPickupTime:e.target.value})))},disabled:"bookingList"===b&&v})}),Object(f.jsx)(c.a,{item:!0,xs:12,md:6,children:Object(f.jsx)(i.a,{label:"Return date",value:(null===D||void 0===D?void 0:D.bookingReturnDate)||"",onChange:function(e){x(Object(O.c)(Object(a.a)(Object(a.a)({},D),{},{bookingReturnDate:e})))},renderInput:function(e){return Object(f.jsx)(s.a,Object(a.a)(Object(a.a)({},e),{},{size:"large",fullWidth:!0,disabled:"bookingList"===b&&v}))},inputFormat:"dd/MM/yyyy",disabled:"bookingList"===b&&v})}),Object(f.jsx)(c.a,{item:!0,xs:12,md:6,children:Object(f.jsx)(s.a,{variant:"outlined",fullWidth:!0,name:"bookingReturnTime",label:"Return time",type:"time",id:"bookingReturnTime",value:(null===D||void 0===D?void 0:D.bookingReturnTime)||"",size:"large",onChange:function(e){x(Object(O.c)(Object(a.a)(Object(a.a)({},D),{},{bookingReturnTime:e.target.value})))},disabled:"bookingList"===b&&v})})]})}},1553:function(e,t,n){"use strict";n.d(t,"a",(function(){return b}));var a=n(9),i=n(133),c=n(286),o=n(1465),r=n(1466),l=n(145),d=n(52),s=n(252),u=n(0);function b(e){var t=e.callLocation,n=e.disableEditing,b=Object(d.b)(),j=Object(d.c)(s.b).bookingData;return Object(u.jsxs)(u.Fragment,{children:[Object(u.jsx)(i.a,{item:!0,xs:12,md:12,children:Object(u.jsx)(c.a,{variant:"h6",children:"Add extra options (Optional)"})}),Object(u.jsx)(i.a,{item:!0,xs:12,md:12,children:Object(u.jsx)(o.a,{})}),Object(u.jsx)(i.a,{item:!0,xs:12,md:8,children:Object(u.jsxs)(r.a,{spacing:1,children:[Object(u.jsx)(c.a,{variant:"subtitle1",children:"Baby Seat"}),Object(u.jsx)(c.a,{children:"Baby seat suitable for 0-13 Kg."})]})}),Object(u.jsx)(i.a,{item:!0,xs:12,md:4,children:Object(u.jsx)(l.a,{label:"Baby seat quantity",variant:"outlined",size:"large",fullWidth:!0,name:"bookingBabySeatQty",type:"number",id:"bookingBabySeatQty",value:(null===j||void 0===j?void 0:j.bookingBabySeatQty)||0,onChange:function(e){Number(e.target.value)>=0&&b(Object(s.c)(Object(a.a)(Object(a.a)({},j),{},{bookingBabySeatQty:e.target.value})))},disabled:"bookingList"===t&&n})}),Object(u.jsx)(i.a,{item:!0,xs:12,md:12,children:Object(u.jsx)(o.a,{})}),Object(u.jsx)(i.a,{item:!0,xs:12,md:8,children:Object(u.jsxs)(r.a,{spacing:1,children:[Object(u.jsx)(c.a,{variant:"subtitle1",children:"Booster Seat"}),Object(u.jsx)(c.a,{children:"Booster Seat suitable for 7-12 years old."})]})}),Object(u.jsx)(i.a,{item:!0,xs:12,md:4,children:Object(u.jsx)(l.a,{label:"Booster seat quantity",variant:"outlined",size:"large",fullWidth:!0,name:"bookingBoosterSeatQty",type:"number",id:"bookingBoosterSeatQty",value:(null===j||void 0===j?void 0:j.bookingBoosterSeatQty)||0,onChange:function(e){Number(e.target.value)>=0&&b(Object(s.c)(Object(a.a)(Object(a.a)({},j),{},{bookingBoosterSeatQty:e.target.value})))},disabled:"bookingList"===t&&n})}),Object(u.jsx)(i.a,{item:!0,xs:12,md:12,children:Object(u.jsx)(o.a,{})}),Object(u.jsx)(i.a,{item:!0,xs:12,md:8,children:Object(u.jsxs)(r.a,{spacing:1,children:[Object(u.jsx)(c.a,{variant:"subtitle1",children:"Child Seat"}),Object(u.jsx)(c.a,{children:"Child seat suitable for 9-18 Kg."})]})}),Object(u.jsx)(i.a,{item:!0,xs:12,md:4,children:Object(u.jsx)(l.a,{label:"Child seat quantity",variant:"outlined",size:"large",fullWidth:!0,name:"bookingChildSeatQty",type:"number",id:"bookingChildSeatQty",value:(null===j||void 0===j?void 0:j.bookingChildSeatQty)||0,onChange:function(e){Number(e.target.value)>=0&&b(Object(s.c)(Object(a.a)(Object(a.a)({},j),{},{bookingChildSeatQty:e.target.value})))},disabled:"bookingList"===t&&n})}),Object(u.jsx)(i.a,{item:!0,xs:12,md:12,children:Object(u.jsx)(o.a,{})})]})}},1554:function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));var a=n(9),i=n(133),c=n(286),o=n(1465),r=n(1466),l=n(50),d=n.n(l),s=n(1566),u=n.n(s),b=n(4),j=n(52),v=n(252),m=n(0);function p(e){var t=e.price,n=e.bookingData,l=Object(j.b)(),s=Object(b.useRef)();return Object(b.useEffect)((function(){s.current()}),[null===n||void 0===n?void 0:n.bookingNumberOfDays,null===n||void 0===n?void 0:n.bookingBabySeatQty,null===n||void 0===n?void 0:n.bookingBoosterSeatQty,null===n||void 0===n?void 0:n.bookingChildSeatQty]),s.current=function(){var e;e=Number((null===n||void 0===n?void 0:n.bookingNumberOfDays)||0)*Number(t||0)+7*Number((null===n||void 0===n?void 0:n.bookingBabySeatQty)||0)+7*Number((null===n||void 0===n?void 0:n.bookingBoosterSeatQty)||0)+7*Number((null===n||void 0===n?void 0:n.bookingChildSeatQty)||0),l(Object(v.c)(Object(a.a)(Object(a.a)({},n),{},{bookingTotalAmount:e})))},Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(i.a,{item:!0,xs:12,md:7,children:Object(m.jsx)(c.a,{children:"Price per day"})}),Object(m.jsx)(i.a,{item:!0,xs:12,md:5,children:Object(m.jsx)(c.a,{align:"right",children:Object(m.jsx)(d.a,{value:Number(t||0).toFixed(2),displayType:"text",thousandSeparator:!0,prefix:"".concat("\u20ac"," ")})})}),Object(m.jsx)(i.a,{item:!0,xs:12,md:12,children:Object(m.jsx)(o.a,{})}),Object(m.jsx)(i.a,{item:!0,xs:12,md:7,children:Object(m.jsx)(c.a,{children:"Rental Days"})}),Object(m.jsx)(i.a,{item:!0,xs:12,md:5,children:Object(m.jsx)(c.a,{align:"right",children:(null===n||void 0===n?void 0:n.bookingNumberOfDays)||0})}),Object(m.jsx)(i.a,{item:!0,xs:12,md:12,children:Object(m.jsx)(o.a,{})}),Object(m.jsx)(i.a,{item:!0,xs:12,md:7,children:Object(m.jsx)(c.a,{children:"Rental Fee"})}),Object(m.jsx)(i.a,{item:!0,xs:12,md:5,children:Object(m.jsx)(c.a,{align:"right",children:Object(m.jsx)(d.a,{value:(Number(t||0)*Number((null===n||void 0===n?void 0:n.bookingNumberOfDays)||0)).toFixed(2),displayType:"text",thousandSeparator:!0,prefix:"".concat("\u20ac"," ")})})}),null!==n&&void 0!==n&&n.bookingBabySeatQty&&Number((null===n||void 0===n?void 0:n.bookingBabySeatQty)||0)>0?Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(i.a,{item:!0,xs:12,md:12,children:Object(m.jsx)(o.a,{})}),Object(m.jsx)(i.a,{item:!0,xs:12,md:7,children:Object(m.jsxs)(r.a,{direction:"row",alignItems:"center",spacing:1,children:[Object(m.jsx)(c.a,{children:"(+) Baby Seat"}),Object(m.jsx)(u.a,{fontSize:"small"}),Object(m.jsx)(c.a,{children:Number(null===n||void 0===n?void 0:n.bookingBabySeatQty)})]})}),Object(m.jsx)(i.a,{item:!0,xs:12,md:5,children:Object(m.jsx)(c.a,{align:"right",children:Object(m.jsx)(d.a,{value:(Number(t||0)*Number((null===n||void 0===n?void 0:n.bookingBabySeatQty)||0)).toFixed(2),displayType:"text",thousandSeparator:!0,prefix:"".concat("\u20ac"," ")})})})]}):Object(m.jsx)(m.Fragment,{}),null!==n&&void 0!==n&&n.bookingBoosterSeatQty&&Number((null===n||void 0===n?void 0:n.bookingBoosterSeatQty)||0)>0?Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(i.a,{item:!0,xs:12,md:12,children:Object(m.jsx)(o.a,{})}),Object(m.jsx)(i.a,{item:!0,xs:12,md:7,children:Object(m.jsxs)(r.a,{direction:"row",alignItems:"center",spacing:1,children:[Object(m.jsx)(c.a,{children:"(+) Booster Seat"}),Object(m.jsx)(u.a,{fontSize:"small"}),Object(m.jsx)(c.a,{children:Number(null===n||void 0===n?void 0:n.bookingBoosterSeatQty)})]})}),Object(m.jsx)(i.a,{item:!0,xs:12,md:5,children:Object(m.jsx)(c.a,{align:"right",children:Object(m.jsx)(d.a,{value:(Number(t||0)*Number((null===n||void 0===n?void 0:n.bookingBoosterSeatQty)||0)).toFixed(2),displayType:"text",thousandSeparator:!0,prefix:"".concat("\u20ac"," ")})})})]}):Object(m.jsx)(m.Fragment,{}),null!==n&&void 0!==n&&n.bookingChildSeatQty&&Number((null===n||void 0===n?void 0:n.bookingChildSeatQty)||0)>0?Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(i.a,{item:!0,xs:12,md:12,children:Object(m.jsx)(o.a,{})}),Object(m.jsx)(i.a,{item:!0,xs:12,md:7,children:Object(m.jsxs)(r.a,{direction:"row",alignItems:"center",spacing:1,children:[Object(m.jsx)(c.a,{children:"(+) Child Seat"}),Object(m.jsx)(u.a,{fontSize:"small"}),Object(m.jsx)(c.a,{children:Number(null===n||void 0===n?void 0:n.bookingChildSeatQty)})]})}),Object(m.jsx)(i.a,{item:!0,xs:12,md:5,children:Object(m.jsx)(c.a,{align:"right",children:Object(m.jsx)(d.a,{value:(Number(t||0)*Number((null===n||void 0===n?void 0:n.bookingChildSeatQty)||0)).toFixed(2),displayType:"text",thousandSeparator:!0,prefix:"".concat("\u20ac"," ")})})})]}):Object(m.jsx)(m.Fragment,{}),Object(m.jsx)(i.a,{item:!0,xs:12,md:12,children:Object(m.jsx)(o.a,{})}),Object(m.jsx)(i.a,{item:!0,xs:12,md:7,children:Object(m.jsx)(c.a,{variant:"h6",children:"Total amount"})}),Object(m.jsx)(i.a,{item:!0,xs:12,md:5,children:Object(m.jsx)(c.a,{align:"right",children:Object(m.jsx)(d.a,{value:Number((null===n||void 0===n?void 0:n.bookingTotalAmount)||0).toFixed(2),displayType:"text",thousandSeparator:!0,prefix:"".concat("\u20ac"," ")})})})]})}},1564:function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=1564},1577:function(e,t,n){"use strict";n.d(t,"a",(function(){return z}));var a=n(9),i=n(6),c=n(18),o=n(3),r=n.n(o),l=(n(1563),n(1398)),d=n(1406),s=n(1413),u=n(1465),b=n(133),j=n(1466),v=n(1484),m=n(1491),p=n(145),h=n(286),O=n(1414),x=n(701),g=n(118),f=n(4),y=n(52),k=n(189),w=n(252),D=n(68),S=n(49),P=n(72),N=n(1552),C=n(1553),A=n(1554),T=n(0);function z(e){var t,n,o,z=e.open,E=e.setOpen,F=e.fetchBooking,Y=e.viewOnly,R=Object(P.a)().user,M=Object(g.b)().enqueueSnackbar,B=Object(y.b)(),I=Object(y.c)(w.b).bookingData,Q=Object(f.useState)(!1),U=Object(c.a)(Q,2),L=U[0],W=U[1];function q(){return(q=Object(i.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return B(Object(D.d)(!0)),e.next=3,S.b.collection("vehiclebooking").doc(null===I||void 0===I?void 0:I.bookingId).set(Object(a.a)({},I),{merge:!0}).then(Object(i.a)(r.a.mark((function e(){var t;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("confirmed"!==(null===I||void 0===I?void 0:I.status)){e.next=7;break}return e.next=3,Object(k.a)();case 3:null!==(t=e.sent)&&void 0!==t&&t.error?(M(null===t||void 0===t?void 0:t.message,{variant:"error"}),B(Object(D.d)(!1))):"client"===(null===R||void 0===R?void 0:R.role)?H("client"):"client"!==(null===R||void 0===R?void 0:R.role)&&H("admin"),e.next=8;break;case 7:"client"===(null===R||void 0===R?void 0:R.role)?H("client"):"client"!==(null===R||void 0===R?void 0:R.role)&&H("admin");case 8:case"end":return e.stop()}}),e)})))).catch((function(e){M("Error occured while updating booking details: ".concat(null===e||void 0===e?void 0:e.message),{variant:"error"}),B(Object(D.d)(!1))}));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function H(e){return J.apply(this,arguments)}function J(){return(J=Object(i.a)(r.a.mark((function e(t){var n,a,i,c;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(k.f)(null===I||void 0===I?void 0:I.bookingId,"".concat((null===R||void 0===R?void 0:R.lastName)||""," ").concat((null===R||void 0===R?void 0:R.firstName)||""),null===R||void 0===R?void 0:R.email,I,null===I||void 0===I||null===(n=I.vehicleDetails)||void 0===n?void 0:n.name,"client",t);case 2:if(null===(a=e.sent)||void 0===a||!a.error){e.next=8;break}M(null===a||void 0===a?void 0:a.message,{variant:"error"}),B(Object(D.d)(!1)),e.next=13;break;case 8:if(null!==a&&void 0!==a&&a.error){e.next=13;break}return e.next=11,Object(k.f)(null===I||void 0===I?void 0:I.bookingId,"Admin","info@reachingheightsltd.com",I,null===I||void 0===I||null===(i=I.vehicleDetails)||void 0===i?void 0:i.name,"admin",t);case 11:null!==(c=e.sent)&&void 0!==c&&c.error?(M(null===c||void 0===c?void 0:c.message,{variant:"error"}),B(Object(D.d)(!1))):(M(null===a||void 0===a?void 0:a.message,{variant:"success"}),M(null===c||void 0===c?void 0:c.message,{variant:"success"}),K(),F(),B(Object(D.d)(!1)));case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function K(){B(Object(w.c)({bookingPickupAddress:null,bookingPickupAnywhereAddress:"",bookingPickupDate:new Date,bookingPickupTime:"00:00",bookingReturnDate:new Date,bookingReturnTime:"00:00",bookingNumberOfDays:0,bookingBabySeatQty:0,bookingBoosterSeatQty:0,bookingChildSeatQty:0,bookingTotalAmount:0})),E(!1)}Object(f.useEffect)((function(){z&&(Y||"client"==(null===R||void 0===R?void 0:R.role)&&("confirmed"===(null===I||void 0===I?void 0:I.status)||"declined"===(null===I||void 0===I?void 0:I.status))?W(!0):W(!1))}),[z]);var V=function(){var e=Object(i.a)(r.a.mark((function e(t,n,i){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault(),"removeOption"!==i&&"clear"!==i&&n?B(Object(w.c)(Object(a.a)(Object(a.a)({},I),{},{status:n}))):"removeOption"!==i&&"clear"!==i||B(Object(w.c)(Object(a.a)(Object(a.a)({},I),{},{status:"pending"})));case 2:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}();return Object(T.jsxs)(l.a,{open:z,maxWidth:"md",fullWidth:!0,children:[Object(T.jsx)(d.a,{children:"Update booking"}),Object(T.jsxs)(s.a,{children:[Object(T.jsx)(u.a,{}),Object(T.jsx)("br",{}),Object(T.jsxs)(b.a,{container:!0,spacing:3,justifyContent:"flex-end",children:[Object(T.jsx)(b.a,{item:!0,xs:12,md:4,children:Object(T.jsxs)(j.a,{spacing:3,children:[Object(T.jsx)(T.Fragment,{children:"pending"===(null===I||void 0===I?void 0:I.status)?Object(T.jsx)(v.a,{severity:"warning",children:"Pending"}):"confirmed"===(null===I||void 0===I?void 0:I.status)&&"client"===(null===R||void 0===R?void 0:R.role)?Object(T.jsx)(v.a,{severity:"success",children:"Confirmed"}):"declined"===(null===I||void 0===I?void 0:I.status)?Object(T.jsx)(v.a,{severity:"error",children:"Declined"}):Object(T.jsx)(T.Fragment,{})}),R&&"client"!==(null===R||void 0===R?void 0:R.role)?Object(T.jsx)(m.a,{size:"small",label:"Please choose status",id:"client-drop-down",options:["pending","confirmed","declined"],value:(null===I||void 0===I?void 0:I.status)||null,renderInput:function(e){return Object(T.jsx)(p.a,Object(a.a)(Object(a.a)({},e),{},{label:"Please choose status",fullWidth:!0}))},onChange:function(e,t,n){return V(e,t,n)},getOptionLabel:function(e){return"pending"===e?"Pending":"confirmed"===e?"Confirmed":"declined"===e?"Declined":""},disabled:L}):Object(T.jsx)(T.Fragment,{})]})}),Object(T.jsx)(N.a,{product:{name:(null===I||void 0===I||null===(t=I.vehicleDetails)||void 0===t?void 0:t.name)||"",price:(null===I||void 0===I||null===(n=I.vehicleDetails)||void 0===n?void 0:n.price)||0},callLocation:"bookingList",disableEditing:L}),Object(T.jsx)(C.a,{callLocation:"bookingList",disableEditing:L}),Object(T.jsx)(u.a,{}),Object(T.jsx)(b.a,{item:!0,xs:12,md:12,children:Object(T.jsx)(h.a,{align:"right",variant:"h5",children:"Price summary"})}),Object(T.jsx)(b.a,{item:!0,xs:12,md:6,children:Object(T.jsx)(b.a,{container:!0,spacing:3,children:Object(T.jsx)(A.a,{price:(null===I||void 0===I||null===(o=I.vehicleDetails)||void 0===o?void 0:o.price)||0,bookingData:I})})})]})]}),Object(T.jsxs)(O.a,{children:[L?Object(T.jsx)(T.Fragment,{}):Object(T.jsx)(x.a,{variant:"contained",color:"primary",size:"large",onClick:function(){!function(){q.apply(this,arguments)}()},children:"Submit changes"}),Object(T.jsx)(x.a,{variant:"outlined",color:"error",size:"large",onClick:function(){return K()},children:"Close"})]})]})}},1809:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return ce}));var a=n(27),i=n(9),c=n(6),o=n(18),r=n(3),l=n.n(r),d=n(4),s=n(1508),u=n(133),b=n(1466),j=n(701),v=n(286),m=n(145),p=n(1516),h=n(1513),O=n(1514),x=n(1482),g=n(1501),f=n(1530),y=n(1531),k=n(1535),w=n(1533),D=n(1534),S=n(1532),P=n(1499),N=n(1465),C=n(1398),A=n(1406),T=n(1413),z=n(1414),E=n(83),F=n(287),Y=n(52),R=n(69),M=n.n(R),B=n(118),I=n(68),Q=n(49),U=n(134),L=n(48),W=n(65),q=n(1527),H=n.n(q),J=n(1526),K=n.n(J),V=n(1654),_=n(1844),Z=n(472),G=n(50),X=n.n(G),$=n(72),ee=n(46),te=(n(250),n(252)),ne=n(1577),ae=n(0),ie=Object(d.lazy)((function(){return n.e(3).then(n.bind(null,1546))}));function ce(){var e,t,n,r,R,q,J,G,ce,oe=Object($.a)().user,re=Object(L.g)(),le=Object(E.a)().themeStretch,de=Object(Y.b)(),se=Object(B.b)().enqueueSnackbar,ue=Object(d.useRef)(),be=Object(d.useState)(""),je=Object(o.a)(be,2),ve=(je[0],je[1]),me=Object(d.useState)(""),pe=Object(o.a)(me,2),he=(pe[0],pe[1]),Oe=Object(d.useRef)(),xe=Object(d.useRef)(),ge=Object(Y.c)(Z.b),fe=ge.companyDetails,ye=ge.clientDocumentObjectSelected,ke=ge.paymentDocType,we=Object(d.useState)([]),De=Object(o.a)(we,2),Se=De[0],Pe=De[1],Ne=Object(d.useState)(new Date),Ce=Object(o.a)(Ne,2),Ae=Ce[0],Te=Ce[1],ze=Object(d.useState)(new Date),Ee=Object(o.a)(ze,2),Fe=Ee[0],Ye=Ee[1],Re=Object(d.useState)(""),Me=Object(o.a)(Re,2),Be=Me[0],Ie=Me[1],Qe=Object(d.useState)(!1),Ue=Object(o.a)(Qe,2),Le=Ue[0],We=Ue[1],qe=Object(d.useState)(null),He=Object(o.a)(qe,2),Je=He[0],Ke=He[1],Ve=Object(d.useState)(!1),_e=Object(o.a)(Ve,2),Ze=_e[0],Ge=_e[1],Xe=Object(d.useState)(!1),$e=Object(o.a)(Xe,2),et=$e[0],tt=$e[1],nt=Object(d.useState)({expenseAmt:0,expenseDesc:""}),at=Object(o.a)(nt,2),it=at[0],ct=at[1],ot=Object(d.useState)(null),rt=Object(o.a)(ot,2),lt=rt[0],dt=rt[1],st=Object(d.useState)(""),ut=Object(o.a)(st,2),bt=ut[0],jt=ut[1],vt=Object(d.useState)(""),mt=Object(o.a)(vt,2),pt=mt[0],ht=mt[1],Ot=Object(d.useState)(""),xt=Object(o.a)(Ot,2),gt=xt[0],ft=xt[1],yt=Object(d.useState)(!1),kt=Object(o.a)(yt,2),wt=kt[0],Dt=kt[1];function St(){return(St=Object(c.a)(l.a.mark((function e(){var t,n,a,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===fe||void 0===fe||null===(t=fe.data)||void 0===t||!t.imageUrl||""===(null===fe||void 0===fe||null===(n=fe.data)||void 0===n?void 0:n.imageUrl)){e.next=6;break}return de(Object(I.d)(!0)),e.next=4,Nt(null===fe||void 0===fe||null===(a=fe.data)||void 0===a?void 0:a.imageUrl);case 4:i=e.sent,ve(i);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Pt(){return(Pt=Object(c.a)(l.a.mark((function e(){var t,n,a,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===fe||void 0===fe||null===(t=fe.data)||void 0===t||!t.sigUrl||""===(null===fe||void 0===fe||null===(n=fe.data)||void 0===n?void 0:n.sigUrl)){e.next=6;break}return de(Object(I.d)(!0)),e.next=4,Nt(null===fe||void 0===fe||null===(a=fe.data)||void 0===a?void 0:a.sigUrl);case 4:i=e.sent,he(i);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Nt(e){return Ct.apply(this,arguments)}function Ct(){return(Ct=Object(c.a)(l.a.mark((function e(t){var n,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""!==t){e.next=4;break}return e.abrupt("return","");case 4:return e.prev=4,e.next=7,fetch(t);case 7:return n=e.sent,e.next=10,n.blob();case 10:return a=e.sent,e.abrupt("return",new Promise((function(e){var t=new FileReader;t.readAsDataURL(a),t.onloadend=function(){var n=t.result;e(n)}})));case 14:e.prev=14,e.t0=e.catch(4),console.log(e.t0);case 17:case"end":return e.stop()}}),e,null,[[4,14]])})))).apply(this,arguments)}function At(){return Tt.apply(this,arguments)}function Tt(){return(Tt=Object(c.a)(l.a.mark((function e(){var t,n,a,c,o,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===Ae||""===Ae||void 0===Fe||""===Fe||!fe){e.next=17;break}if(!(new Date(Ae)>new Date(Fe))){e.next=6;break}se("Date incorrect. To Date cannot be before From Date.",{variant:"error"}),de(Object(I.d)(!1)),e.next=15;break;case 6:return de(Object(I.d)(!0)),t=Ae.toISOString(),n=t.split("T"),a=Fe.toISOString(),c=a.split("T"),o=new Date("".concat(n[0],"T00:00:00.000Z")),r=new Date("".concat(c[0],"T23:59:59.000Z")),e.next=15,Q.b.collection("vehiclebooking").where("dateCreated",">=",U.a.firestore.Timestamp.fromDate(o)).where("dateCreated","<=",U.a.firestore.Timestamp.fromDate(r)).get().then((function(e){var t,n=[];(null===e||void 0===e||null===(t=e.docs)||void 0===t?void 0:t.length)>0?(null===e||void 0===e||e.docs.forEach((function(e){var t,a,c,o,r,l=Number((null===e||void 0===e||null===(t=e.data())||void 0===t?void 0:t.docRemainingPaymentAmt)||0),d=0;null!==e&&void 0!==e&&null!==(a=e.data())&&void 0!==a&&a.invoiceExpensetData&&(null===e||void 0===e||null===(c=e.data())||void 0===c||null===(o=c.invoiceExpensetData)||void 0===o?void 0:o.length)>0&&(null===e||void 0===e||null===(r=e.data())||void 0===r||r.invoiceExpensetData.forEach((function(e){d+=Number((null===e||void 0===e?void 0:e.expenseAmt)||0)})));n.push({checked:!1,id:null===e||void 0===e?void 0:e.id,data:Object(i.a)({},null===e||void 0===e?void 0:e.data()),paymentAmt:0,paymentType:"",docRemainingPaymentAmt:l,totalExpenseAmountForInvoice:d})})),Pe(n)):Pe([]),de(Object(I.d)(!1))})).catch((function(e){se("Error occured while fetching bookings: ".concat(null===e||void 0===e?void 0:e.message),{variant:"error"}),de(Object(I.d)(!1))}));case 15:e.next=18;break;case 17:de(Object(I.d)(!1));case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function zt(e,t){var n,o,r,d,s=[],u=e.toString();1===(null===(n=u)||void 0===n?void 0:n.length)?u="0000".concat(u):2===(null===(o=u)||void 0===o?void 0:o.length)?u="000".concat(u):3===(null===(r=u)||void 0===r?void 0:r.length)?u="00".concat(u):4===(null===(d=u)||void 0===d?void 0:d.length)&&(u="0".concat(u));var b=Q.b.batch(),j=e.toString(),v=Q.b.collection("company").doc(fe.id).collection("payment").doc("paymentCounter"),m=Q.b.collection("company").doc(fe.id).collection("payment").doc(j);t.forEach((function(e){var t,n,c,o,r,l,d=Q.b.collection("vehiclebooking").doc(e.id),v=Number((null===e||void 0===e?void 0:e.docRemainingPaymentAmt)||0),m=[];null!==e&&void 0!==e&&null!==(t=e.data)&&void 0!==t&&t.attachedPaymentNumber&&(null===e||void 0===e||null===(n=e.data)||void 0===n||null===(c=n.attachedPaymentNumber)||void 0===c?void 0:c.length)>0?m=[].concat(Object(a.a)(null===e||void 0===e||null===(l=e.data)||void 0===l?void 0:l.attachedPaymentNumber),[{paymentNumber:j,paymentNumberString:u,paymentType:null===e||void 0===e?void 0:e.paymentType,paymentAmount:null===e||void 0===e?void 0:e.paymentAmount,paymentRemainingAmount:v,paymentDate:M()(new Date).format("DD-MM-YYYY")}]):m.push({paymentNumber:j,paymentNumberString:u,paymentType:null===e||void 0===e?void 0:e.paymentType,paymentAmount:null===e||void 0===e?void 0:e.paymentAmount,paymentRemainingAmount:v,paymentDate:M()(new Date).format("DD-MM-YYYY")});var p="";v===Number((null===e||void 0===e||null===(o=e.data)||void 0===o?void 0:o.bookingTotalAmount)||0)?p="Unpaid":v>0&&v<Number((null===e||void 0===e||null===(r=e.data)||void 0===r?void 0:r.bookingTotalAmount)||0)?p="Partially paid":v<0?p="Over paid":0===v&&(p="Paid"),s.push(Object(i.a)(Object(i.a)({invoiceId:null===e||void 0===e?void 0:e.id},null===e||void 0===e?void 0:e.data),{},{attachedPaymentNumber:m,paymentStatus:p,docRemainingPaymentAmt:v})),b.set(d,{docRemainingPaymentAmt:v,attachedPaymentNumber:m,paymentStatus:p},{merge:!0})})),b.set(v,{paymentCounter:Number(e)},{merge:!0}),b.set(m,{invoiceList:s,paymentDate:M()(new Date).format("DD-MM-YYYY"),dateCreated:U.a.firestore.Timestamp.fromDate(new Date)},{merge:!0}),b.commit().then(Object(c.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return se("Payment stored successfully"),jt(""),ht(""),ft(""),Dt(!1),e.next=7,At();case 7:de(Object(I.d)(!1));case 8:case"end":return e.stop()}}),e)}))))}function Et(){return(Et=Object(c.a)(l.a.mark((function e(t,n,a,o,r){var d,s,u,b,j,v;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:de(Object(I.d)(!0)),n&&(null===n||void 0===n?void 0:n.length)>0?(d=[],n.forEach((function(e){(null===e||void 0===e?void 0:e.paymentNumber)!==(null===t||void 0===t?void 0:t.paymentNumber)&&d.push(Object(i.a)({},e))})),s=0,void 0!==a&&null!==a&&(s=Number(null===t||void 0===t?void 0:t.paymentAmount)+Number(a)),u="",s===Number(r||0)?u="Unpaid":s>0&&s<Number(r||0)?u="Partially paid":s<0?u="Over paid":0===s&&(u="Paid"),b=Q.b.batch(),j=Q.b.collection("vehiclebooking").doc(o),v=Q.b.collection("company").doc(fe.id).collection("payment").doc(null===t||void 0===t?void 0:t.paymentNumber),b.set(j,{attachedPaymentNumber:d,docRemainingPaymentAmt:s,paymentStatus:u},{merge:!0}),b.set(v,{isDeleted:!0,deletedTimestamp:U.a.firestore.FieldValue.serverTimestamp()},{merge:!0}),b.commit().then(Object(c.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return se("Payment removed and Invoice updated successfully."),e.next=3,At();case 3:de(Object(I.d)(!1));case 4:case"end":return e.stop()}}),e)})))).catch((function(e){se("Error occured while executing batch: ".concat(null===e||void 0===e?void 0:e.message),{variant:"error"}),de(Object(I.d)(!1))}))):de(Object(I.d)(!1));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ft(){return Ft=Object(c.a)(l.a.mark((function e(t){var n,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Se.find((function(e){return e.id===t})),Object(V.isEmpty)(n)||(de(Object(I.d)(!0)),a=Q.b.collection("company").doc(fe.id).collection("payment").doc("paymentCounter"),Q.b.runTransaction(function(){var e=Object(c.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.get(a).then((function(e){return e.exists?Number(e.data().paymentCounter||0)+1:null})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).then(function(){var e=Object(c.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==t){e.next=5;break}return e.next=3,Q.b.collection("company").doc(fe.id).collection("payment").doc("paymentCounter").set({paymentCounter:1}).then(Object(c.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Yt(1,n);case 2:case"end":return e.stop()}}),e)})))).catch((function(e){se("Error occured while creating payment counter: ".concat(null===e||void 0===e?void 0:e.message),{variant:"error"}),de(Object(I.d)(!1))}));case 3:e.next=8;break;case 5:if(!(t&&Number(t)>0)){e.next=8;break}return e.next=8,Yt(t,n);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){se("Error occured while executing payment transaction: ".concat(null===e||void 0===e?void 0:e.message),{variant:"error"}),de(Object(I.d)(!1))})));case 2:case"end":return e.stop()}}),e)}))),Ft.apply(this,arguments)}function Yt(e,t){return Rt.apply(this,arguments)}function Rt(){return(Rt=Object(c.a)(l.a.mark((function e(t,n){var a,o,r,d,s,u,b,j,v,m,p;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:u=t.toString(),1===(null===(a=u)||void 0===a?void 0:a.length)?u="0000".concat(u):2===(null===(o=u)||void 0===o?void 0:o.length)?u="000".concat(u):3===(null===(r=u)||void 0===r?void 0:r.length)?u="00".concat(u):4===(null===(d=u)||void 0===d?void 0:d.length)&&(u="0".concat(u)),b=Q.b.batch(),j=t.toString(),v=Q.b.collection("company").doc(fe.id).collection("payment").doc("paymentCounter"),m=Q.b.collection("company").doc(fe.id).collection("payment").doc(j),p=Q.b.collection("vehiclebooking").doc(n.id),b.set(v,{paymentCounter:Number(t)},{merge:!0}),b.set(m,{invoiceList:[Object(i.a)({},n)],paymentDate:M()(new Date).format("DD-MM-YYYY"),dateCreated:U.a.firestore.Timestamp.fromDate(new Date)},{merge:!0}),b.set(p,{paymentStatus:"Paid",docRemainingPaymentAmt:0,attachedPaymentNumber:[{paymentNumber:j,paymentNumberString:u,paymentType:"",paymentAmount:(null===n||void 0===n||null===(s=n.data)||void 0===s?void 0:s.bookingTotalAmount)||0,paymentRemainingAmount:0,paymentDate:M()(new Date).format("DD-MM-YYYY")}]},{merge:!0}),b.commit().then(Object(c.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return se("Full payment stored successfully"),e.next=3,At();case 3:de(Object(I.d)(!1));case 4:case"end":return e.stop()}}),e)}))));case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}Object(d.useEffect)((function(){Oe.current(),xe.current()}),[fe]),Object(d.useEffect)((function(){ue.current()}),[Ae,Fe,fe,ye,ke]),Oe.current=function(){return St.apply(this,arguments)},xe.current=function(){return Pt.apply(this,arguments)},ue.current=At;var Mt=function(){var e=Object(c.a)(l.a.mark((function e(t,n){var c,o,r,d,s,u,b,j,v;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),!(t.target.files&&t.target.files.length>0)){e.next=24;break}return de(Object(I.d)(!0)),o="",r=new Date,d=r.toISOString(),s="/screenshot/".concat(null===fe||void 0===fe?void 0:fe.id,"/").concat(null===Je||void 0===Je||null===(c=Je.invoiceData)||void 0===c?void 0:c.docType,"/").concat(d),u=t.target.files[0],b=Q.c.storage().ref(),j=b.child(s),e.next=12,j.put(u);case 12:return e.next=14,j.getDownloadURL();case 14:if(!(o=e.sent)){e.next=22;break}return(v=Object(a.a)((null===Je||void 0===Je?void 0:Je.invoiceScreenshotData)||[])).push({dateString:d,screenshotUrl:o,screenshotStoragePath:s,timestamp:U.a.firestore.Timestamp.fromDate(new Date)}),e.next=20,Q.b.collection("vehiclebooking").doc(null===Je||void 0===Je?void 0:Je.invoiceId).set({invoiceScreenshotData:v},{merge:!0}).then((function(){Ke(Object(i.a)(Object(i.a)({},Je),{},{invoiceScreenshotData:v})),se("Sreenshot uploaded successfully"),de(Object(I.d)(!1)),At()})).catch((function(e){se("Error occured while uploading screenshot: ".concat((null===e||void 0===e?void 0:e.message)||""),{variant:"error"}),de(Object(I.d)(!1))}));case 20:e.next=24;break;case 22:se("Error occured while getting screenshot storage url",{variant:"error"}),de(Object(I.d)(!1));case 24:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();function Bt(){return(Bt=Object(c.a)(l.a.mark((function e(t){var n,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===t||void 0===t||!t.screenshotStoragePath){e.next=6;break}return de(Object(I.d)(!0)),n=Q.c.storage().ref(),o=n.child(null===t||void 0===t?void 0:t.screenshotStoragePath),e.next=6,o.delete().then(Object(c.a)(l.a.mark((function e(){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(n=Object(a.a)((null===Je||void 0===Je?void 0:Je.invoiceScreenshotData)||[])).filter((function(e){return(null===e||void 0===e?void 0:e.screenshotStoragePath)!==(null===t||void 0===t?void 0:t.screenshotStoragePath)})),e.next=4,Q.b.collection("vehiclebooking").doc(null===Je||void 0===Je?void 0:Je.invoiceId).set({invoiceScreenshotData:n},{merge:!0}).then((function(){Ke(Object(i.a)(Object(i.a)({},Je),{},{invoiceScreenshotData:n})),se("Sreenshot deleted successfully"),de(Object(I.d)(!1)),At()})).catch((function(e){se("Error occured while deleting screenshot: ".concat((null===e||void 0===e?void 0:e.message)||""),{variant:"error"}),de(Object(I.d)(!1))}));case 4:case"end":return e.stop()}}),e)})))).catch((function(e){se("Error occured while deleting screenshot: ".concat((null===e||void 0===e?void 0:e.message)||""),{variant:"error"}),de(Object(I.d)(!1))}));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function It(){return(It=Object(c.a)(l.a.mark((function e(){var t,n,c,o,r,d;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(de(Object(I.d)(!0)),c="",o=Object(a.a)((null===lt||void 0===lt||null===(t=lt.invoiceData)||void 0===t?void 0:t.invoiceExpensetData)||[]),null===it||void 0===it||!it.expenseStoragePath){e.next=11;break}return r=Q.c.storage().ref(),d=r.child(null===it||void 0===it?void 0:it.expenseStoragePath),e.next=8,d.put(null===it||void 0===it?void 0:it.expenseFile);case 8:return e.next=10,d.getDownloadURL();case 10:c=e.sent;case 11:return c?o.push({dateString:null===it||void 0===it?void 0:it.dateString,expenseAmt:null===it||void 0===it?void 0:it.expenseAmt,expenseDesc:null===it||void 0===it?void 0:it.expenseDesc,expenseUrl:c,expenseStoragePath:null===it||void 0===it?void 0:it.expenseStoragePath,timestamp:U.a.firestore.Timestamp.fromDate(new Date)}):o.push({dateString:"",expenseAmt:null===it||void 0===it?void 0:it.expenseAmt,expenseDesc:null===it||void 0===it?void 0:it.expenseDesc,expenseUrl:"",expenseStoragePath:"",timestamp:U.a.firestore.Timestamp.fromDate(new Date)}),e.next=14,Q.b.collection("company").doc(null===fe||void 0===fe?void 0:fe.id).collection(null===lt||void 0===lt||null===(n=lt.invoiceData)||void 0===n?void 0:n.docType).doc(null===lt||void 0===lt?void 0:lt.invoiceId).set({invoiceExpensetData:o},{merge:!0}).then((function(){dt(Object(i.a)(Object(i.a)({},lt),{},{invoiceData:Object(i.a)(Object(i.a)({},null===lt||void 0===lt?void 0:lt.invoiceData),{},{invoiceExpensetData:o})})),At(),se("Expense uploaded successfully"),tt(!1),de(Object(I.d)(!1))})).catch((function(e){se("Error occured while uploading expense: ".concat((null===e||void 0===e?void 0:e.message)||""),{variant:"error"}),de(Object(I.d)(!1))}));case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Qt(){return(Qt=Object(c.a)(l.a.mark((function e(t,n){var a,o,r,d,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(de(Object(I.d)(!0)),null===t||void 0===t||!t.expenseStoragePath){e.next=6;break}return r=Q.c.storage().ref(),d=r.child(null===t||void 0===t?void 0:t.expenseStoragePath),e.next=6,d.delete().then(Object(c.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:se("Image Url deleted successfully"),de(Object(I.d)(!1));case 2:case"end":return e.stop()}}),e)})))).catch((function(e){se("Error occured while deleting expense: ".concat((null===e||void 0===e?void 0:e.message)||""),{variant:"error"}),de(Object(I.d)(!1))}));case 6:return de(Object(I.d)(!0)),s=[],null===lt||void 0===lt||null===(a=lt.invoiceData)||void 0===a||a.invoiceExpensetData.forEach((function(e){(null===e||void 0===e?void 0:e.expenseDesc)!==(null===t||void 0===t?void 0:t.expenseDesc)&&(e.timestamp&&M()(e.timestamp.toDate()).format("DD-MM-YYYY, HH:MM:ss")||"")!==(t.timestamp&&M()(t.timestamp.toDate()).format("DD-MM-YYYY, HH:MM:ss")||"")&&s.push(Object(i.a)({},t))})),e.next=11,Q.b.collection("company").doc(null===fe||void 0===fe?void 0:fe.id).collection(null===lt||void 0===lt||null===(o=lt.invoiceData)||void 0===o?void 0:o.docType).doc(null===lt||void 0===lt?void 0:lt.invoiceId).set({invoiceExpensetData:s},{merge:!0}).then((function(){dt(Object(i.a)(Object(i.a)({},lt),{},{invoiceData:Object(i.a)(Object(i.a)({},null===lt||void 0===lt?void 0:lt.invoiceData),{},{invoiceExpensetData:s})})),At(),se("Expense deleted successfully"),de(Object(I.d)(!1))})).catch((function(e){se("Error occured while deleting expense: ".concat((null===e||void 0===e?void 0:e.message)||""),{variant:"error"}),de(Object(I.d)(!1))}));case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ut=Object(d.useState)(!1),Lt=Object(o.a)(Ut,2),Wt=Lt[0],qt=Lt[1];return Object(ae.jsxs)(F.a,{title:"Payment/Expense",children:[Object(ae.jsx)(s.a,{maxWidth:!le&&"xl",children:Object(ae.jsxs)(u.a,{container:!0,spacing:3,children:[Object(ae.jsx)(u.a,{item:!0,xs:12,md:12,children:Object(ae.jsxs)(b.a,{spacing:3,direction:"row",alignItems:"center",children:[Object(ae.jsx)(j.a,{startIcon:Object(ae.jsx)(H.a,{}),variant:"outlined",color:"primary",onClick:function(){return re(W.b.general.app1)},children:"Back"}),Object(ae.jsx)(v.a,{variant:"h3",children:"Payment/Expense section"})]})}),Object(ae.jsx)(d.Suspense,{fallback:Object(ae.jsx)(ae.Fragment,{}),children:Object(ae.jsx)(ie,{type:"payment"})}),Object(ae.jsx)("br",{}),Object(ae.jsx)("br",{}),fe&&Object(ae.jsx)(ae.Fragment,{children:Object(ae.jsx)(u.a,{item:!0,xs:12,md:12,children:Object(ae.jsxs)(b.a,{spacing:3,children:[Object(ae.jsx)("hr",{}),Object(ae.jsx)(v.a,{children:"Please choose any booking and insert an amount"}),Object(ae.jsxs)(b.a,{direction:"row",spacing:3,alignItems:"center",children:[Object(ae.jsx)(_.a,{label:"From",value:Ae||"",onChange:function(e){Te(e)},renderInput:function(e){return Object(ae.jsx)(m.a,Object(i.a)(Object(i.a)({},e),{},{size:"small"}))},inputFormat:"dd/MM/yyyy"}),Object(ae.jsx)(_.a,{label:"To",value:Fe||"",onChange:function(e){Ye(e)},renderInput:function(e){return Object(ae.jsx)(m.a,Object(i.a)(Object(i.a)({},e),{},{size:"small"}))},inputFormat:"dd/MM/yyyy"})]}),Object(ae.jsx)(p.a,{children:Object(ae.jsxs)(b.a,{style:{padding:"10px"},children:[Object(ae.jsx)("br",{}),Object(ae.jsxs)(h.a,{fullWidth:!0,variant:"outlined",size:"small",style:{width:"300px"},disabled:!Se||0===(null===Se||void 0===Se?void 0:Se.length),children:[Object(ae.jsx)(O.a,{id:"paymentType-select-label",children:"Filter"}),Object(ae.jsxs)(x.a,{labelId:"paymentType-select-label",label:"Filter",value:Be||"",onChange:function(e){Ie(e.target.value)},children:[Object(ae.jsx)(g.a,{value:"",children:"All"}),Object(ae.jsx)(g.a,{value:"Unpaid",children:"Unpaid"}),Object(ae.jsx)(g.a,{value:"Partially paid",children:"Partially paid"}),Object(ae.jsx)(g.a,{value:"Over paid",children:"Over paid"}),Object(ae.jsx)(g.a,{value:"Paid",children:"Paid"})]})]}),Object(ae.jsx)("br",{}),Object(ae.jsx)(f.a,{children:Object(ae.jsxs)(y.a,{border:1,children:[Object(ae.jsx)(k.a,{children:Object(ae.jsxs)(w.a,{children:[Object(ae.jsx)(D.a,{size:"small",align:"center",style:{whiteSpace:"nowrap"},children:"Status"}),Object(ae.jsx)(D.a,{size:"small",align:"center",style:{whiteSpace:"nowrap"},children:"View booking details"}),Object(ae.jsx)(D.a,{size:"small",align:"center",style:{whiteSpace:"nowrap"},children:"Booking Number"}),Object(ae.jsx)(D.a,{size:"small",align:"center",style:{whiteSpace:"nowrap"},children:"Datetime created"}),Object(ae.jsx)(D.a,{size:"small",align:"center",style:{whiteSpace:"nowrap"},children:"Do full payment"}),Object(ae.jsx)(D.a,{size:"small",align:"center",style:{whiteSpace:"nowrap"},children:"Add partial payment"}),Object(ae.jsx)(D.a,{size:"small",align:"center",style:{whiteSpace:"nowrap"},children:"Bill to"}),Object(ae.jsx)(D.a,{size:"small",align:"center",style:{whiteSpace:"nowrap"},children:"Booking amount"}),Object(ae.jsx)(D.a,{size:"small",align:"center",style:{whiteSpace:"nowrap"},children:"Remaining amount"}),Object(ae.jsx)(D.a,{size:"small",align:"center",style:{whiteSpace:"nowrap"},children:"Recent payment made"}),Object(ae.jsx)(D.a,{size:"small",align:"center",style:{whiteSpace:"nowrap"},children:"Upload/view screenshot"})]})}),Object(ae.jsx)(S.a,{children:Se&&(null===Se||void 0===Se?void 0:Se.length)>0&&(null===(e=Se.filter((function(e){var t,n;return""===Be&&""!==(null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.paymentStatus)||""!==Be&&(null===e||void 0===e||null===(n=e.data)||void 0===n?void 0:n.paymentStatus)===Be})))||void 0===e?void 0:e.map((function(e,t){var n,a,c,o,r,l,s,u,m,p,h,O,x,g,f;return Object(ae.jsxs)(w.a,{children:[Object(ae.jsx)(D.a,{size:"small",align:"center",style:{whiteSpace:"nowrap"},children:(null===e||void 0===e||null===(n=e.data)||void 0===n?void 0:n.paymentStatus)||"Un Paid"}),Object(ae.jsx)(D.a,{align:"center",size:"small",style:{whiteSpace:"nowrap"},children:Object(ae.jsx)(b.a,{direction:"row",alignItems:"center",justifyContent:"center",spacing:2,children:Object(ae.jsx)(P.a,{variant:"contained",color:"primary",onClick:function(){var t,n;de(Object(te.c)(Object(i.a)(Object(i.a)({},null===e||void 0===e?void 0:e.data),{},{bookingPickupDate:null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.bookingPickupDate.toDate(),bookingReturnDate:null===e||void 0===e||null===(n=e.data)||void 0===n?void 0:n.bookingReturnDate.toDate()}))),qt(!0)},children:Object(ae.jsx)(ee.a,{icon:"carbon:view"})})})}),Object(ae.jsx)(D.a,{size:"small",align:"center",style:{whiteSpace:"nowrap"},children:(null===e||void 0===e||null===(a=e.data)||void 0===a?void 0:a.bookingId)||""}),Object(ae.jsx)(D.a,{size:"small",align:"center",style:{whiteSpace:"nowrap"},children:M()(null===e||void 0===e||null===(c=e.data)||void 0===c?void 0:c.dateCreated.toDate()).format("DD-MM-YYYY, HH:MM:ss")}),Object(ae.jsx)(D.a,{size:"small",align:"center",style:{whiteSpace:"nowrap"},children:Object(ae.jsx)(j.a,{variant:"contained",color:"primary",onClick:function(){return function(e){return Ft.apply(this,arguments)}(null===e||void 0===e?void 0:e.id)},disabled:Number(null===e||void 0===e||null===(o=e.data)||void 0===o?void 0:o.docRemainingPaymentAmt)<Number(null===e||void 0===e||null===(r=e.data)||void 0===r?void 0:r.bookingTotalAmount)&&Number(null===e||void 0===e||null===(l=e.data)||void 0===l?void 0:l.docRemainingPaymentAmt)>0||0===Number(null===e||void 0===e||null===(s=e.data)||void 0===s?void 0:s.docRemainingPaymentAmt),children:"Make full payment"})}),Object(ae.jsx)(D.a,{size:"small",align:"center",style:{whiteSpace:"nowrap"},children:Object(ae.jsx)(j.a,{variant:"contained",color:"primary",onClick:function(){jt(null===e||void 0===e?void 0:e.id),Dt(!0)},disabled:0===Number(null===e||void 0===e||null===(u=e.data)||void 0===u?void 0:u.docRemainingPaymentAmt),children:"Add partial-payment"})}),Object(ae.jsx)(D.a,{size:"small",align:"center",style:{whiteSpace:"nowrap"},children:(null===e||void 0===e||null===(m=e.data)||void 0===m?void 0:m.clientName)||""}),Object(ae.jsx)(D.a,{size:"small",align:"center",style:{whiteSpace:"nowrap"},children:Object(ae.jsx)(X.a,{value:Number((null===e||void 0===e||null===(p=e.data)||void 0===p?void 0:p.bookingTotalAmount)||0).toFixed(2),displayType:"text",thousandSeparator:!0})}),Object(ae.jsx)(D.a,{size:"small",align:"center",style:{whiteSpace:"nowrap",background:0===Number((null===e||void 0===e?void 0:e.docRemainingPaymentAmt)||0)?"#C6FEBE":Number((null===e||void 0===e?void 0:e.docRemainingPaymentAmt)||0)<0?"#FEC3BE":"#FEFEBE"},children:Number((null===e||void 0===e?void 0:e.docRemainingPaymentAmt)||0).toFixed(2)}),Object(ae.jsx)(D.a,{size:"small",align:"center",style:{whiteSpace:"nowrap"},children:null!==e&&void 0!==e&&null!==(h=e.data)&&void 0!==h&&h.attachedPaymentNumber&&(null===e||void 0===e||null===(O=e.data)||void 0===O||null===(x=O.attachedPaymentNumber)||void 0===x?void 0:x.length)>0?null===e||void 0===e||null===(g=e.data)||void 0===g||null===(f=g.attachedPaymentNumber)||void 0===f?void 0:f.map((function(t,n){var a,i,c;return Object(ae.jsxs)(d.Fragment,{children:[Object(ae.jsxs)(b.a,{direction:"row",alignItems:"center",children:[Object(ae.jsx)(P.a,{onClick:function(){var n,a;return function(e,t,n,a,i){return Et.apply(this,arguments)}(t,null===e||void 0===e||null===(n=e.data)||void 0===n?void 0:n.attachedPaymentNumber,null===e||void 0===e?void 0:e.docRemainingPaymentAmt,null===e||void 0===e?void 0:e.id,null===e||void 0===e||null===(a=e.data)||void 0===a?void 0:a.bookingTotalAmount)},disabled:!(null!==oe&&void 0!==oe&&null!==(a=oe.permissions)&&void 0!==a&&null!==(i=a.deleteFullPartialPaymentChk)&&void 0!==i&&null!==(c=i.assignedCompanyId)&&void 0!==c&&c.includes(null===fe||void 0===fe?void 0:fe.id)),children:Object(ae.jsx)(K.a,{color:"error"})}),Object(ae.jsx)(v.a,{children:"Date: ".concat(null===t||void 0===t?void 0:t.paymentDate,", Payment: ").concat(Number(null===t||void 0===t?void 0:t.paymentAmount).toFixed(2))})]}),Object(ae.jsx)(N.a,{})]},n)})):"No recent payment made"}),Object(ae.jsx)(D.a,{size:"small",align:"center",style:{whiteSpace:"nowrap"},children:Object(ae.jsx)(j.a,{variant:"contained",color:"primary",onClick:function(){var t;We(!0),Ke({invoiceId:null===e||void 0===e?void 0:e.id,invoiceScreenshotData:(null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.invoiceScreenshotData)||null,invoiceData:Object(i.a)({},null===e||void 0===e?void 0:e.data)})},children:"upload/view"})})]},t)})))})]})})]})})]})})})]})}),Le?Object(ae.jsx)(ae.Fragment,{children:Object(ae.jsxs)(C.a,{open:Le,onClose:function(){We(!1),Ke(null)},fullWidth:!0,maxWidth:"md",children:[Object(ae.jsx)(A.a,{children:"Payment screenshots"}),Object(ae.jsxs)(T.a,{children:[Object(ae.jsx)("br",{}),Object(ae.jsxs)(v.a,{children:["Upload Screenshot"," ",Object(ae.jsx)("span",{style:{color:"red"},children:"(Max Size of 25 KB)"}),":"," "]}),Object(ae.jsx)(m.a,{className:"uploadInput",variant:"outlined",size:"small",fullWidth:!0,name:"image",type:"file",id:"image",accept:".png,.jpeg",onChange:function(e){return Mt(e)}}),Object(ae.jsx)("br",{}),Object(ae.jsx)("br",{}),Object(ae.jsx)(f.a,{children:Object(ae.jsxs)(y.a,{border:1,children:[Object(ae.jsx)(k.a,{children:Object(ae.jsxs)(w.a,{children:[Object(ae.jsx)(D.a,{size:"small",children:"Date"}),Object(ae.jsx)(D.a,{size:"small",children:"View"}),Object(ae.jsx)(D.a,{size:"small",children:"Delete"})]})}),Object(ae.jsx)(S.a,{children:(null===Je||void 0===Je?void 0:Je.invoiceScreenshotData)&&(null===Je||void 0===Je||null===(t=Je.invoiceScreenshotData)||void 0===t?void 0:t.length)>0&&(null===Je||void 0===Je||null===(n=Je.invoiceScreenshotData)||void 0===n?void 0:n.map((function(e,t){return Object(ae.jsxs)(w.a,{children:[Object(ae.jsx)(D.a,{size:"small",children:(null===e||void 0===e?void 0:e.dateString)||""}),Object(ae.jsx)(D.a,{size:"small",children:null!==e&&void 0!==e&&e.screenshotUrl&&""!==(null===e||void 0===e?void 0:e.screenshotUrl)?Object(ae.jsx)(j.a,{variant:"contained",color:"primary",href:"".concat(null===e||void 0===e?void 0:e.screenshotUrl),target:"_blank",children:"open"}):Object(ae.jsx)(v.a,{children:"No url found"})}),Object(ae.jsx)(D.a,{size:"small",children:Object(ae.jsx)(j.a,{variant:"contained",color:"error",onClick:function(){return function(e){return Bt.apply(this,arguments)}(e)},children:"delete"})})]},t)})))})]})})]}),Object(ae.jsx)(z.a,{children:Object(ae.jsx)(j.a,{onClick:function(){We(!1),Ke(null)},variant:"contained",color:"error",children:"Close"})})]})}):Object(ae.jsx)(ae.Fragment,{}),Ze?Object(ae.jsx)(ae.Fragment,{children:Object(ae.jsxs)(C.a,{open:Ze,onClose:function(){Ge(!1),tt(!1),dt(null)},fullWidth:!0,maxWidth:"md",children:[Object(ae.jsx)(A.a,{children:"Expenses"}),Object(ae.jsxs)(T.a,{children:[Object(ae.jsx)("br",{}),!et&&Object(ae.jsx)(j.a,{onClick:function(){return tt(!0)},variant:"contained",color:"primary",children:"Add expense"}),et&&Object(ae.jsxs)(u.a,{container:!0,spacing:3,children:[Object(ae.jsx)(u.a,{item:!0,xs:12,md:12,children:Object(ae.jsx)(m.a,{variant:"outlined",size:"small",fullWidth:!0,name:"expenseAmount",type:"text",id:"expenseAmount",label:"Expense amount",onChange:function(e){ct(Object(i.a)(Object(i.a)({},it),{},{expenseAmt:e.target.value}))},required:!0})}),Object(ae.jsx)(u.a,{item:!0,xs:12,md:12,children:Object(ae.jsx)(m.a,{variant:"outlined",size:"small",fullWidth:!0,name:"expenseDesc",type:"text",id:"expenseDesc",label:"Expense description",onChange:function(e){ct(Object(i.a)(Object(i.a)({},it),{},{expenseDesc:e.target.value}))},required:!0})}),Object(ae.jsxs)(u.a,{item:!0,xs:12,md:12,children:[Object(ae.jsxs)(v.a,{children:["Upload expense"," ",Object(ae.jsx)("span",{style:{color:"red"},children:"(Max Size of 25 KB)"}),":"," "]}),Object(ae.jsx)(m.a,{className:"uploadInput",variant:"outlined",size:"small",fullWidth:!0,name:"image",type:"file",id:"image",accept:".png,.jpeg,.pdf",onChange:function(e){return function(e){if(e.target.files&&e.target.files.length>0){var t,n=(new Date).toISOString(),a="/expense/".concat(null===fe||void 0===fe?void 0:fe.id,"/").concat(null===lt||void 0===lt||null===(t=lt.invoiceData)||void 0===t?void 0:t.docType,"/").concat(n),c=e.target.files[0];ct(Object(i.a)(Object(i.a)({},it),{},{dateString:n,expenseStoragePath:a,expenseFile:c}))}}(e)}})]}),Object(ae.jsx)(u.a,{item:!0,xs:12,md:12,children:Object(ae.jsx)(j.a,{onClick:function(){return function(){return It.apply(this,arguments)}()},variant:"contained",color:"primary",disabled:!(null!==it&&void 0!==it&&it.expenseAmt)||!(null!==it&&void 0!==it&&it.expenseDesc)||!(null!==oe&&void 0!==oe&&null!==(r=oe.permissions)&&void 0!==r&&r.addExpense),children:"add expense"})})]}),Object(ae.jsx)("br",{}),Object(ae.jsx)("br",{}),Object(ae.jsx)(f.a,{children:Object(ae.jsxs)(y.a,{border:1,children:[Object(ae.jsx)(k.a,{children:Object(ae.jsxs)(w.a,{children:[Object(ae.jsx)(D.a,{size:"small",style:{whiteSpace:"nowrap"},children:"Date"}),Object(ae.jsx)(D.a,{size:"small",style:{whiteSpace:"nowrap"},children:"Amount"}),Object(ae.jsx)(D.a,{size:"small",style:{whiteSpace:"nowrap"},children:"Description"}),Object(ae.jsx)(D.a,{size:"small",style:{whiteSpace:"nowrap"},children:"View uploaded image"}),Object(ae.jsx)(D.a,{size:"small",style:{whiteSpace:"nowrap"},children:"Delete"})]})}),Object(ae.jsx)(S.a,{children:(null===lt||void 0===lt||null===(R=lt.invoiceData)||void 0===R?void 0:R.invoiceExpensetData)&&(null===lt||void 0===lt||null===(q=lt.invoiceData)||void 0===q||null===(J=q.invoiceExpensetData)||void 0===J?void 0:J.length)>0&&(null===lt||void 0===lt||null===(G=lt.invoiceData)||void 0===G||null===(ce=G.invoiceExpensetData)||void 0===ce?void 0:ce.map((function(e,t){var n;return Object(ae.jsxs)(w.a,{children:[Object(ae.jsx)(D.a,{size:"small",style:{whiteSpace:"nowrap"},children:(null===e||void 0===e?void 0:e.dateString)||e.timestamp&&M()(e.timestamp.toDate()).format("DD-MM-YYYY, HH:MM:ss")||""}),Object(ae.jsx)(D.a,{size:"small",style:{whiteSpace:"nowrap"},children:Object(ae.jsx)(X.a,{value:Math.round(Number((null===e||void 0===e?void 0:e.expenseAmt)||0)),displayType:"text",thousandSeparator:!0})}),Object(ae.jsx)(D.a,{size:"small",style:{whiteSpace:"nowrap"},children:(null===e||void 0===e?void 0:e.expenseDesc)||""}),Object(ae.jsx)(D.a,{size:"small",style:{whiteSpace:"nowrap"},children:null!==e&&void 0!==e&&e.expenseUrl&&""!==(null===e||void 0===e?void 0:e.expenseUrl)?Object(ae.jsx)(j.a,{variant:"contained",color:"primary",href:"".concat(null===e||void 0===e?void 0:e.expenseUrl),target:"_blank",children:"open"}):Object(ae.jsx)(v.a,{children:"No url found"})}),Object(ae.jsx)(D.a,{size:"small",style:{whiteSpace:"nowrap"},children:Object(ae.jsx)(P.a,{onClick:function(){!function(e,t){Qt.apply(this,arguments)}(e,t)},disabled:!(null!==oe&&void 0!==oe&&null!==(n=oe.permissions)&&void 0!==n&&n.deleteExpense),color:"error",children:Object(ae.jsx)(K.a,{})})})]},t)})))})]})})]}),Object(ae.jsx)(z.a,{children:Object(ae.jsx)(j.a,{onClick:function(){Ge(!1),tt(!1),dt(null)},variant:"contained",color:"error",children:"Close"})})]})}):Object(ae.jsx)(ae.Fragment,{}),wt?Object(ae.jsx)(ae.Fragment,{children:Object(ae.jsxs)(C.a,{open:wt,onClose:function(){jt(""),ht(""),ft(""),Dt(!1)},fullWidth:!0,maxWidth:"sm",children:[Object(ae.jsx)(A.a,{children:"Add partial payment"}),Object(ae.jsxs)(T.a,{children:[Object(ae.jsx)("br",{}),Object(ae.jsxs)(b.a,{spacing:3,children:[Object(ae.jsx)(m.a,{variant:"outlined",name:"payment",label:"Payment amount",id:"payment",type:"text",value:pt||"",size:"small",fullWidth:!0,onChange:function(e){return ht(e.target.value)},required:!0}),Object(ae.jsxs)(h.a,{fullWidth:!0,variant:"outlined",size:"small",style:{background:Number(pt||0)>0&&""===gt?"#FEFEBE":"transparent"},disabled:!pt||0===Number(pt||0)||Number(pt||0)<0,children:[Object(ae.jsx)(O.a,{required:!0,id:"paymentType-select-label",children:"Choose type"}),Object(ae.jsxs)(x.a,{required:!0,labelId:"paymentType-select-label",label:"Choose type",value:gt||"",onChange:function(e){ft(e.target.value)},children:[Object(ae.jsx)(g.a,{value:"",children:"Choose a payment type"}),Object(ae.jsx)(g.a,{value:"cheque",children:"Cheque"}),Object(ae.jsx)(g.a,{value:"cash",children:"Cash"}),Object(ae.jsx)(g.a,{value:"JUICE",children:"JUICE"}),Object(ae.jsx)(g.a,{value:"Bank Transfer",children:"Bank Transfer"})]})]})]})]}),Object(ae.jsxs)(z.a,{children:[Object(ae.jsx)(j.a,{onClick:function(){return function(){if(Se&&(null===Se||void 0===Se?void 0:Se.length)>0){de(Object(I.d)(!0));var e=[];Se.forEach((function(t){var n;if((null===t||void 0===t||null===(n=t.data)||void 0===n?void 0:n.bookingId)===bt){var a,c,o,r,l,d=0,s="";(d=Number((null===t||void 0===t||null===(a=t.data)||void 0===a?void 0:a.docRemainingPaymentAmt)||0)>0?Number((null===t||void 0===t||null===(r=t.data)||void 0===r?void 0:r.docRemainingPaymentAmt)||0)-Number(pt):Number((null===t||void 0===t||null===(l=t.data)||void 0===l?void 0:l.bookingTotalAmount)||0)-Number(pt))===Number((null===t||void 0===t||null===(c=t.data)||void 0===c?void 0:c.bookingTotalAmount)||0)?s="Unpaid":0!==d&&d<Number((null===t||void 0===t||null===(o=t.data)||void 0===o?void 0:o.bookingTotalAmount)||0)?s="Partially paid":d<0?s="Over paid":0===d&&(s="Paid"),e.push(Object(i.a)(Object(i.a)({},t),{},{paymentAmount:pt,paymentType:gt,data:Object(i.a)(Object(i.a)({},t.data),{},{paymentStatus:s}),docRemainingPaymentAmt:d}))}}));var t=Q.b.collection("company").doc(fe.id).collection("payment").doc("paymentCounter");Q.b.runTransaction(function(){var e=Object(c.a)(l.a.mark((function e(n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.get(t).then((function(e){return e.exists?Number(e.data().paymentCounter||0)+1:null})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).then(function(){var t=Object(c.a)(l.a.mark((function t(n){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null!==n){t.next=5;break}return t.next=3,Q.b.collection("company").doc(fe.id).collection("payment").doc("paymentCounter").set({paymentCounter:1}).then((function(){zt(1,e)})).catch((function(e){se("Error occured while creating payment counter: ".concat(null===e||void 0===e?void 0:e.message),{variant:"error"}),de(Object(I.d)(!1))}));case 3:t.next=6;break;case 5:n&&Number(n)>0&&zt(n,e);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).catch((function(e){se("Error occured while executing payment transaction: ".concat(null===e||void 0===e?void 0:e.message),{variant:"error"}),de(Object(I.d)(!1))}))}}()},variant:"contained",color:"primary",disabled:!bt||!pt||!gt,children:"Add"}),Object(ae.jsx)(j.a,{onClick:function(){jt(""),ht(""),ft(""),Dt(!1)},variant:"contained",color:"error",children:"Close"})]})]})}):Object(ae.jsx)(ae.Fragment,{}),Wt?Object(ae.jsx)(ne.a,{open:Wt,setOpen:qt,fetchBooking:At,viewOnly:!0}):Object(ae.jsx)(ae.Fragment,{})]})}}}]);
//# sourceMappingURL=35.9d1ac942.chunk.js.map