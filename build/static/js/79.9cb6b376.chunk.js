(this["webpackJsonp@minimal/minimal-kit-react"]=this["webpackJsonp@minimal/minimal-kit-react"]||[]).push([[79],{1772:function(e,n,i){"use strict";i.r(n),i.d(n,"default",(function(){return S}));var r=i(6),t=i(18),a=i(3),o=i.n(a),c=i(1398),s=i(1406),l=i(1413),d=i(118),u=i(52),v=i(68),m=i(49),p=i(27),h=i(9),b=i(1542),g=i(4),j=i(54),f=i(1543),O=i(13),x=i(286),w=i(133),y=i(1491),C=i(145),k=i(1517),I=i(701),N=i(202),P=i(0),V=["Automatic","Manual"],D=Object(O.a)(x.a)((function(e){var n=e.theme;return Object(h.a)(Object(h.a)({},n.typography.subtitle2),{},{color:n.palette.text.secondary,marginBottom:n.spacing(1)})}));function E(e){var n=e.isEdit,i=e.currentProduct,t=e.addVehicle,a=e.updateVehicle,c=e.handleCloseDialog,s=e.setImagesListChanged,l=b.d().shape({name:b.e().required("Name is required"),featuredImage:b.a().min(1,"Featured images is required, at least one image"),description:b.e().required("Description is required"),plateNumber:b.e().required("Plate number is required"),price:b.c().moreThan(0,"Price should not be 0"),passengers:b.c().moreThan(0,"Passengers should not be 0"),doors:b.c().moreThan(0,"Doors should not be 0")}),d=Object(g.useMemo)((function(){return{featuredImage:(null===i||void 0===i?void 0:i.featuredImage)||[],name:(null===i||void 0===i?void 0:i.name)||"",description:(null===i||void 0===i?void 0:i.description)||"",serviceCategory:(null===i||void 0===i?void 0:i.serviceCategory)||[],plateNumber:(null===i||void 0===i?void 0:i.plateNumber)||"",price:(null===i||void 0===i?void 0:i.price)||0,passengers:(null===i||void 0===i?void 0:i.passengers)||0,luggage:(null===i||void 0===i?void 0:i.luggage)||!1,doors:(null===i||void 0===i?void 0:i.doors)||0,transmission:(null===i||void 0===i?void 0:i.transmission)||null,airConditioning:(null===i||void 0===i?void 0:i.airConditioning)||!1}}),[i]),u=Object(j.f)({resolver:Object(f.a)(l),defaultValues:d}),v=u.reset,m=u.watch,O=u.setValue,x=u.getValues,E=(u.handleSubmit,m());Object(g.useEffect)((function(){n&&i&&v(d),n||v(d)}),[n,i]);var L=function(){var e=Object(r.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n?a(E):t(E);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),S=Object(g.useCallback)((function(e){s(!0);var n=e.map((function(e){return Object.assign(e,{preview:URL.createObjectURL(e)})})),i=[].concat(Object(p.a)(E.featuredImage||[]),Object(p.a)(n));O("featuredImage",i)}),[O]);return Object(P.jsx)(N.a,{methods:u,children:Object(P.jsxs)(w.a,{container:!0,spacing:3,children:[Object(P.jsx)(w.a,{item:!0,xs:12,md:12,children:Object(P.jsx)(N.h,{name:"name",label:"Vehicle Name"})}),Object(P.jsx)(w.a,{item:!0,xs:12,md:12,children:Object(P.jsx)(y.a,{ListboxProps:{style:{maxHeight:"70vh"}},size:"small",label:"Please choose a category",id:"category-drop-down",options:[{id:"category01",serviceName:"Small Compact"},{id:"category02",serviceName:"Saloon"},{id:"category03",serviceName:"4x4"},{id:"category04",serviceName:"7 Seater"},{id:"category05",serviceName:"SUV"}],value:(null===E||void 0===E?void 0:E.serviceCategory)||[],renderInput:function(e){return Object(P.jsx)(C.a,Object(h.a)(Object(h.a)({},e),{},{label:"Please choose a category",fullWidth:!0,size:"large"}))},onChange:function(e,n){O("serviceCategory",n)},getOptionLabel:function(e){return e.serviceName},multiple:!0})}),Object(P.jsx)(w.a,{item:!0,xs:12,md:12,children:Object(P.jsx)(N.h,{name:"plateNumber",label:"Plate number"})}),Object(P.jsx)(w.a,{item:!0,xs:12,md:12,children:Object(P.jsxs)("div",{children:[Object(P.jsx)(D,{children:"Description"}),Object(P.jsx)(N.c,{simple:!0,name:"description"})]})}),Object(P.jsx)(w.a,{item:!0,xs:12,md:12,children:Object(P.jsxs)("div",{children:[Object(P.jsx)(D,{children:"Featured images"}),Object(P.jsx)(N.j,{name:"featuredImage",showPreview:!0,accept:"image/*",maxSize:3145728,onDrop:S,onRemove:function(e){var n;s(!0);var i=null===(n=E.featuredImage)||void 0===n?void 0:n.filter((function(n){return(null===n||void 0===n?void 0:n.preview)!==(null===e||void 0===e?void 0:e.preview)}));O("featuredImage",i)},onRemoveAll:function(){s(!0),O("featuredImage",[])}})]})}),Object(P.jsx)(w.a,{item:!0,xs:12,md:6,children:Object(P.jsx)(N.h,{name:"price",label:"Regular Price",placeholder:"0.00",value:0===x("price")?"":x("price"),onChange:function(e){return O("price",e.target.value)},InputLabelProps:{shrink:!0},InputProps:{startAdornment:Object(P.jsx)(k.a,{position:"start",children:"\u20ac"}),type:"text"}})}),Object(P.jsx)(w.a,{item:!0,xs:12,md:6,children:Object(P.jsx)(N.h,{name:"passengers",label:"Number of passenger seats"})}),Object(P.jsx)(w.a,{item:!0,xs:12,md:6,children:Object(P.jsx)(N.g,{name:"luggage",label:"Luggage"})}),Object(P.jsx)(w.a,{item:!0,xs:12,md:6,children:Object(P.jsx)(N.h,{name:"doors",label:"Number of doors"})}),Object(P.jsx)(w.a,{item:!0,xs:12,md:6,children:Object(P.jsx)(y.a,{ListboxProps:{style:{maxHeight:"70vh"}},size:"small",label:"Transmission",id:"transmission-drop-down",options:V,value:(null===E||void 0===E?void 0:E.transmission)||null,renderInput:function(e){return Object(P.jsx)(C.a,Object(h.a)(Object(h.a)({},e),{},{label:"Transmission",fullWidth:!0,size:"large"}))},onChange:function(e,n,i){"removeOption"!==i&&"clear"!==i&&n?O("transmission",n):"removeOption"!==i&&"clear"!==i||O("transmission",null)},getOptionLabel:function(e){return e}})}),Object(P.jsx)(w.a,{item:!0,xs:12,md:6,children:Object(P.jsx)(N.g,{name:"airConditioning",label:"Air conditioning"})}),Object(P.jsx)(w.a,{item:!0,xs:12,md:12,children:Object(P.jsxs)(w.a,{container:!0,spacing:3,children:[Object(P.jsx)(w.a,{item:!0,xs:12,md:6,children:Object(P.jsx)(I.a,{variant:"contained",color:"success",onClick:function(){return L()},size:"large",fullWidth:!0,children:n?"Save Changes":"Create Product"})}),Object(P.jsx)(w.a,{item:!0,xs:12,md:6,children:Object(P.jsx)(I.a,{variant:"outlined",color:"error",onClick:function(){return c()},size:"large",fullWidth:!0,children:"Close"})})]})})]})})}var L=i(134);function S(e){var n=e.dialogType,i=e.openDialog,a=e.handleCloseDialog,p=e.vehicleDetails,h=(e.setVehicleDetails,e.initialiseVehicles),b=Object(d.b)().enqueueSnackbar,j=Object(u.b)(),f=Object(g.useState)(!1),O=Object(t.a)(f,2),x=O[0],w=O[1],y=function(){var e=Object(r.a)(o.a.mark((function e(n){var i,t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(j(Object(v.d)(!0)),null!==n&&void 0!==n&&n.name&&null!==n&&void 0!==n&&n.price&&null!==n&&void 0!==n&&n.passengers&&null!==n&&void 0!==n&&n.doors&&null!==n&&void 0!==n&&n.transmission&&0!==(null===n||void 0===n||null===(i=n.featuredImage)||void 0===i?void 0:i.length)){e.next=6;break}b("Please fill in all the inputs",{variant:"error"}),j(Object(v.d)(!1)),e.next=12;break;case 6:return e.next=8,k(n);case 8:if(!(t=e.sent)){e.next=12;break}return e.next=12,m.b.collection("vehicles").add({name:(null===n||void 0===n?void 0:n.name)||"",plateNumber:(null===n||void 0===n?void 0:n.plateNumber)||"",price:(null===n||void 0===n?void 0:n.price)||"",passengers:(null===n||void 0===n?void 0:n.passengers)||"",doors:(null===n||void 0===n?void 0:n.doors)||"",transmission:(null===n||void 0===n?void 0:n.transmission)||null,airConditioning:(null===n||void 0===n?void 0:n.airConditioning)||"",featuredImage:t||[],serviceCategory:(null===n||void 0===n?void 0:n.serviceCategory)||null,dateTimeCreated:L.a.firestore.Timestamp.fromDate(new Date)}).then(Object(r.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:b("Vehicle created successfully",{variant:"success"}),h(),j(Object(v.d)(!1)),a();case 4:case"end":return e.stop()}}),e)})))).catch((function(e){b("Error occured while creating Vehicle. Error: ".concat(null===e||void 0===e?void 0:e.message),{variant:"error"}),j(Object(v.d)(!1))}));case 12:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),C=function(){var e=Object(r.a)(o.a.mark((function e(n){var i,t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(j(Object(v.d)(!0)),null!==n&&void 0!==n&&n.name&&null!==n&&void 0!==n&&n.price&&null!==n&&void 0!==n&&n.passengers&&null!==n&&void 0!==n&&n.doors&&null!==n&&void 0!==n&&n.transmission&&0!==(null===n||void 0===n||null===(i=n.featuredImage)||void 0===i?void 0:i.length)){e.next=6;break}b("Please fill in all the inputs",{variant:"error"}),j(Object(v.d)(!1)),e.next=16;break;case 6:return e.next=8,k(n);case 8:if(!(t=e.sent)){e.next=14;break}return e.next=12,m.b.collection("vehicles").doc(null===p||void 0===p?void 0:p.id).set({name:(null===n||void 0===n?void 0:n.name)||"",plateNumber:(null===n||void 0===n?void 0:n.plateNumber)||"",price:(null===n||void 0===n?void 0:n.price)||"",passengers:(null===n||void 0===n?void 0:n.passengers)||"",doors:(null===n||void 0===n?void 0:n.doors)||"",transmission:(null===n||void 0===n?void 0:n.transmission)||"",airConditioning:(null===n||void 0===n?void 0:n.airConditioning)||"",featuredImage:t||[],serviceCategory:(null===n||void 0===n?void 0:n.serviceCategory)||null},{merge:!0}).then(Object(r.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:b("Vehicle updated successfully"),h(),j(Object(v.d)(!1)),a();case 4:case"end":return e.stop()}}),e)})))).catch((function(e){b("Error occured while creating Vehicle. Error: ".concat(null===e||void 0===e?void 0:e.message),{variant:"error"}),j(Object(v.d)(!1))}));case 12:e.next=16;break;case 14:return e.next=16,m.b.collection("vehicles").doc(null===p||void 0===p?void 0:p.id).set({name:(null===n||void 0===n?void 0:n.name)||"",plateNumber:(null===n||void 0===n?void 0:n.plateNumber)||"",price:(null===n||void 0===n?void 0:n.price)||"",passengers:(null===n||void 0===n?void 0:n.passengers)||"",doors:(null===n||void 0===n?void 0:n.doors)||"",transmission:(null===n||void 0===n?void 0:n.transmission)||"",airConditioning:(null===n||void 0===n?void 0:n.airConditioning)||"",serviceCategory:(null===n||void 0===n?void 0:n.serviceCategory)||null},{merge:!0}).then(Object(r.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:b("Vehicle updated successfully"),h(),j(Object(v.d)(!1)),a();case 4:case"end":return e.stop()}}),e)})))).catch((function(e){b("Error occured while creating Vehicle. Error: ".concat(null===e||void 0===e?void 0:e.message),{variant:"error"}),j(Object(v.d)(!1))}));case 16:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();function k(e){return I.apply(this,arguments)}function I(){return I=Object(r.a)(o.a.mark((function e(n){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise(function(){var e=Object(r.a)(o.a.mark((function e(i){var t,a,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:x?(t=null===n||void 0===n?void 0:n.featuredImage,"car-rental-vehicles-images",a=[],c=m.c.storage().ref("".concat("car-rental-vehicles-images","/").concat(null===n||void 0===n?void 0:n.name,"/")),t.forEach((function(e,n){a.push(new Promise(function(){var i=Object(r.a)(o.a.mark((function i(r){var t;return o.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return t=c.child("image".concat(n+1)),i.next=3,t.put(e).then((function(){t.getDownloadURL().then((function(e){r({error:!1,imageObject:{name:"image".concat(n+1),url:e}})})).catch((function(e){r({error:!0,message:"Error occured while retrieving the download url: ".concat(null===e||void 0===e?void 0:e.message)})}))})).catch((function(e){r({error:!0,message:"Error occured while uploading the file in the storage folder: ".concat(null===e||void 0===e?void 0:e.message)})}));case 3:case"end":return i.stop()}}),i)})));return function(e){return i.apply(this,arguments)}}()))})),Promise.all(a).then(function(){var e=Object(r.a)(o.a.mark((function e(n){var r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],n&&(null===n||void 0===n?void 0:n.length)>0&&(n.forEach((function(e){var n,i,t;null!==e&&void 0!==e&&e.error||r.push({downloadURL:null===e||void 0===e||null===(n=e.imageObject)||void 0===n?void 0:n.url,preview:null===e||void 0===e||null===(i=e.imageObject)||void 0===i?void 0:i.url,name:null===e||void 0===e||null===(t=e.imageObject)||void 0===t?void 0:t.name})})),i(r));case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}())):i(null);case 1:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}());case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),I.apply(this,arguments)}return Object(P.jsx)(P.Fragment,{children:Object(P.jsxs)(c.a,{open:i,onClose:a,fullWidth:!0,maxWidth:"md",children:[Object(P.jsx)(s.a,{id:"alert-dialog-title",children:n&&"add"===n?"Create vehicle":"Update vehicle"}),Object(P.jsx)(l.a,{style:{paddingTop:"1em"},children:Object(P.jsx)(E,{isEdit:"add"!==n,currentProduct:p,addVehicle:y,updateVehicle:C,handleCloseDialog:a,setImagesListChanged:w})})]})})}}}]);
//# sourceMappingURL=79.9cb6b376.chunk.js.map