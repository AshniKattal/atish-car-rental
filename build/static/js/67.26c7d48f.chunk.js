(this["webpackJsonp@minimal/minimal-kit-react"]=this["webpackJsonp@minimal/minimal-kit-react"]||[]).push([[67],{1854:function(o,t,e){"use strict";e.r(t),e.d(t,"default",(function(){return m}));var i=e(9),n=e(28),a=e(7),d=e(3),r=e.n(d),l=e(705),c=e(52),u=e(77),s=e(472),A=e(251),_=e(120),E=e(48),T=e(155),v=e(72),P=e(0);function m(o){var t=o.updateDocumentData,e=o.documentDetails,d=o.us_s_quotationNumber,m=o.us_s_purchaseOrderNumber,R=o.handleCloseUpdateDialog,p=o.displayDiscountColumns,C=Object(v.a)().user,S=Object(_.b)().enqueueSnackbar,O=Object(c.b)(),b=Object(c.c)(s.b),N=b.documentType,I=b.companyIdSelected,D=b.companyDetails,h=e.docCustomIdNumber,f=e.docBillTo,y=e.docShipTo,g=e.docDate,w=e.docParticulars,L=e.docSubTotal,V=e.docVatFee,B=e.docTotal,M=e.docTermsAndCondition,x=e.docBLNumber,k=e.docSupplier,U=e.docContainerNumber,j=e.docPackages,H=e.docDescription,F=e.docGrossWeight,Y=e.docVolume,G=e.docPortOfLoading,K=e.docETA,W=e.docVesselName,Z=e.docRoE,q=e.docPlaceOfLanding,z=e.transactionType,Q=e.personType,J=e.invoiceTypeDesc,X=e.invoiceRefIdentifier,$=e.downPayment,oo=e.downPaymentInvoiceNumber,to=e.discountTotalAmount,eo=e.discountedTotalAmount,io=e.docSalesTransaction,no=e.docReasonStated,ao=e.docTotalTaxableWithoutVatParticulars,ro=e.docTotalTaxableVatOnlyParticulars,lo=e.docTotalTaxableParticulars,co=e.docTotalZeroRatedParticulars,uo=e.docTotalExemptParticulars,so=e.docTotalDisbursementParticulars,Ao=e.docTotalExemptBodiesParticulars,_o=e.docDisbursementParticularsData,Eo=e.invJobRef,To=e.invStorageFee,vo=e.invScanningFee,Po=e.invGatePassFee,mo=e.invVehicleNo,Ro=e.transportFees,po=e.transportDesc,Co=e.invApplyVat,So=e.docShipper,Oo=e.docMarkNos,bo=e.docCommodity,No=e.docHbl,Io=e.docDepot;function Do(){return(Do=Object(a.a)(r.a.mark((function o(){var e;return r.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(O(Object(u.d)(!0)),!h){o.next=8;break}return o.next=4,Object(A.d)(h,I,null===N||void 0===N?void 0:N.id);case 4:null!==(e=o.sent)&&void 0!==e&&e.error?S(null===e||void 0===e?void 0:e.message,{variant:"error"}):ho(null===t||void 0===t?void 0:t.id,(null===t||void 0===t?void 0:t.keywords)||[]),o.next=9;break;case 8:ho(t.id,(null===t||void 0===t?void 0:t.keywords)||[]);case 9:case"end":return o.stop()}}),o)})))).apply(this,arguments)}function ho(o,t){return fo.apply(this,arguments)}function fo(){return fo=Object(a.a)(r.a.mark((function o(e,l){var c,s,A,_,v,P,b,Do,ho,fo,yo,go,wo,Lo,Vo,Bo,Mo;return r.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return ho=Number(B),null!==t&&void 0!==t&&null!==(c=t.data)&&void 0!==c&&c.attachedPaymentNumber&&(null===t||void 0===t||null===(s=t.data)||void 0===s||null===(A=s.attachedPaymentNumber)||void 0===A?void 0:A.length)>0&&(null===t||void 0===t||null===(fo=t.data)||void 0===fo||fo.attachedPaymentNumber.forEach((function(o){ho-=Number(null===o||void 0===o?void 0:o.paymentAmount)}))),yo=Object(n.a)(l),"transport"!==(null===D||void 0===D||null===(_=D.data)||void 0===_?void 0:_.documentTemplate)&&(go="",w.map((function(o){return(null===o||void 0===o?void 0:o.rowDescription)||""})).forEach(function(){var o=Object(a.a)(r.a.mark((function o(t){return r.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:t&&""!==t&&(go=go+" "+t);case 1:case"end":return o.stop()}}),o)})));return function(t){return o.apply(this,arguments)}}()),go&&(wo=go.split(" "),Lo=[],wo.forEach((function(o){Lo.push(o.toLowerCase())})),yo=[].concat(Object(n.a)(yo),Lo)),yo=Object(n.a)(new Set(yo))),Vo=[],"transport"===(null===D||void 0===D||null===(v=D.data)||void 0===v?void 0:v.documentTemplate)&&(null===w||void 0===w?void 0:w.length)>0&&w.forEach((function(o){Vo.push(Object(i.a)(Object(i.a)({},o),{},{valueList:[]}))})),Bo={docQuoteNumber:d||"",docPurchaseOrderNumber:m||"",docParticulars:"transport"===(null===D||void 0===D||null===(P=D.data)||void 0===P?void 0:P.documentTemplate)?Vo:w,docSubTotal:L,docVatFee:V,docTotal:B,docRemainingPaymentAmt:ho,docBillTo:f,docShipTo:y,docTermsAndCondition:M||"",docCustomIdNumber:h,docDate:T.a.firestore.Timestamp.fromDate(new Date(g)),keywords:yo,transactionType:z||null,personType:Q||null,invoiceTypeDesc:J||null,invoiceRefIdentifier:X||"",downPayment:$||0,downPaymentInvoiceNumber:oo||"",discountTotalAmount:to||0,discountedTotalAmount:eo||0,docSalesTransaction:io||null,docReasonStated:no||"",displayDiscountColumns:p||!1,updatedByUserId:(null===C||void 0===C?void 0:C.id)||"",updatedByUserEmail:(null===C||void 0===C?void 0:C.email)||"",updatedByUserTime:new Date},"transport"===(null===D||void 0===D||null===(b=D.data)||void 0===b?void 0:b.documentTemplate)?Bo=Object(i.a)(Object(i.a)({},Bo),{},{invJobRef:Eo||"",invStorageFee:To||"",invScanningFee:vo||"",invGatePassFee:Po||"",invVehicleNo:mo||"",transportFees:Ro||"",transportDesc:po||"",invApplyVat:Co||!1}):"flexitrans"===(null===D||void 0===D||null===(Do=D.data)||void 0===Do?void 0:Do.documentTemplate)&&(Bo=Object(i.a)(Object(i.a)({},Bo),{},{docBLNumber:x||"",docSupplier:k||"",docContainerNumber:U||"",docPackages:j||"",docDescription:H||"",docGrossWeight:F||"",docVolume:Y||"",docPortOfLoading:G||"",docETA:K||"",docVesselName:W||"",docRoE:Z||"",docPlaceOfLanding:q||"",docTotalTaxableWithoutVatParticulars:ao||"",docTotalTaxableVatOnlyParticulars:ro||"",docTotalTaxableParticulars:lo||"",docTotalZeroRatedParticulars:co||"",docTotalExemptParticulars:uo||"",docTotalDisbursementParticulars:so||"",docTotalExemptBodiesParticulars:Ao||"",docDisbursementParticularsData:_o||[],docShipper:So||"",docMarkNos:Oo||"",docCommodity:bo||"",docHbl:No||"",docDepot:Io||""})),(null===D||void 0===D?void 0:D.id)!==Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_PROTECTED_COMPANY:"d49MsS8JbYcUnff60n0E",REACT_APP_PROTECTED_USER:"Baelzs07ToMHTlIPzsHqjMZLBL72",REACT_APP_CUSTOM_REQUIREMENT_WORLDLINK_EXAMPLE:'["9VNEXj9ahhngQ3U8oQ4i"]',REACT_APP_EBS_MRA_ID:"17128123218161EW4CBZY12Y",REACT_APP_EBS_MRA_USERNAME:"Oudish",REACT_APP_EBS_MRA_PASSWORD:"Ash124Ash124",REACT_APP_EBS_MRA_REFRESH_TOKEN_PARAM:"FALSE",REACT_APP_EBS_MRA_TOKEN_ENDPOINT:"https://vfisc.mra.mu/einvoice-token-service/token-api/generate-token",REACT_APP_EBS_TRANSACTION_TYPES:'[{"id": "B2B","type": "(B2B) Business to Business"},{"id": "B2G","type": "(B2G) Business to Government"},{"id": "B2C","type": "(B2C) Business to Consumer"},{"id": "EXP","type": "(EXP) Zero rated supplies - Exports"},{"id": "B2E","type": "(B2E) Taxable supplies made to exempt bodies or persons"}]',REACT_APP_EBS_VAT_OR_NON_VAT_REGISTERED_VALUES:'[{"id":"VATR","title":"VAT Registered"},{"id":"NVTR","title":"Non VAT Registered"}]',REACT_APP_EBS_BUYER_TYPE_VALUES:'[{"id":"VATR","title":"VAT Registered Person"},{"id":"NVTR","title":"Non VAT Registered Person"},{"id":"EXMP","title":"Exempt Person"}]',REACT_APP_EBS_TAX_CODE_VALUES:'[{"id":"TC01","title":"(T) Taxable rate - 15%"},{"id":"TC02","title":"(Z) Zero rated"},{"id":"TC03","title":"(E) Exempt"},{"id":"TC04","title":"(D - Disbursement) Non fiscal items not affecting turnover"},{"id":"TC05","title":"(TEB) Standard rated supplies made to exempt bodies or persons"}]',REACT_APP_EBS_NATURE_VALUES:'[{"id":"GOODS","title":"Goods"},{"id":"SERVICES","title":"Services"}]',REACT_APP_EBS_SALES_TRANSACTION_VALUES:'[{"id":"CASH","title":"CASH (Cash/Bank Transfers/Cheques/Cards/Other)"},{"id":"CREDIT","title":"Credit"}]',REACT_APP_PARTICULAR_DESC_OPTIONS:'["Gate Pass", "Landing Charges"]',REACT_APP_EBS_INVOICE_TYPE_DESC_INVOICE:'[{"id": "STD","type": "Standard"},{"id": "TRN","type": "Training"}]',REACT_APP_EBS_INVOICE_TYPE_DESC_CREDIT_NOTE:'[{"id": "CRN","type": "Credit"}]',REACT_APP_EBS_INVOICE_TYPE_DESC_DEBIT_NOTE:'[{"id": "DRN","type": "Debit"}]',REACT_APP_EBS_INVOICE_TYPE_DESC_PROFORMA:'[{"id": "PRF","type": "Proforma"}]',REACT_APP_DOCUMENT_TEMPLATES:'["std", "transport", "slarks", "smart_promote", "flexitrans"]',REACT_APP_EMAILJS_PUBLIC_KEY:"GSb72AhjTKPF-1qEF",REACT_APP_CONVERT_API_SECRET:"13cZcSaMcOWpV9lI",REACT_APP_ADMIN_EMAIL:"contact@fertositeweb.com",REACT_APP_ADMIN_EMAIL_SERVICE_KEY:"service_4u2qlcp",REACT_APP_REGISTRATION_FORM_TEMPLATE_KEY:"template_gtoask8",REACT_APP_INQUIRY_FORM_TEMPLATE_KEY:"template_u6twrz9",REACT_APP_SOA_TEMPLATE_KEY:"template_0p7wave",REACT_APP_SOFTWARE_NAME:"Reaching Heights Ltd",REACT_APP_OWNER_CAR_RENTAL_ATISH:"carrentalatish",REACT_APP_OWNER:"carrentalatish",REACT_APP_VERSION:"4.1.8",REACT_APP_API_KEY:"AIzaSyDYknQfnmlUF6VJPhU9d0yFgf1ZKmGtuEA",REACT_APP_AUTH_DOMAIN:"car-rental-39926.firebaseapp.com",REACT_APP_PROJECT_ID:"car-rental-39926",REACT_APP_STORAGE_BUCKET:"car-rental-39926.appspot.com",REACT_APP_MESSAGING_SENDER_ID:"398655009731",REACT_APP_APP_ID:"1:398655009731:web:fa32fd1360970c0f1e8376",REACT_APP_MEASUREMENT_ID:"G-68J9VBEQEP",REACT_APP_DISTRICT:'["Flacq","Grand Port","Moka","Pamplemousses","Plaines Wilhems","Port Louis","Rivi\xe8re du Rempart","Rivi\xe8re Noire","Savanne"]',REACT_APP_GOOGLE_MAP_API_KEY:"AIzaSyAuUzKzg8D3zZkgeEz7oXFwBDnMulZX26I",REACT_APP_COLLECTION_STORES:"stores",REACT_APP_COLLECTION_SERVICES:"services",REACT_APP_COLLECTION_VEHICLES:"vehicles",REACT_APP_CURRENCY_USED:"\u20ac",REACT_APP_ICON_180:"/favicon/carrental/apple-touch-icon.png",REACT_APP_ICON_32:"/favicon/carrental/favicon-32x32.png",REACT_APP_ICON_16:"/favicon/carrental/favicon-16x16.png",REACT_APP_TITLE:"Reaching Heights Ltd",REACT_APP_DESCRIPTION:"Car Rental platform",REACT_APP_KEYWORDS:"Reaching Heights Ltd,RHL,car-rental,Car Rental",REACT_APP_AUTHOR:"Reaching Heights Ltd",REACT_APP_RHL_ID:"5HAEgHE1kKox9ZdweP3I",REACT_APP_COMPANY_ID:"5HAEgHE1kKox9ZdweP3I",REACT_APP_COMPANY_NAME:"REACHING HEIGHTS LTD",REACT_APP_SERVICE_KEY:"service_ishhonm",REACT_APP_TEMPLATE_KEY:"template_u6twrz9",REACT_APP_EMAIL:"info@reachingheightsltd.com",REACT_APP_LIGHTER:"#B3C3E8",REACT_APP_LIGHT:"#5381ED",REACT_APP_MAIN:"#333333",REACT_APP_DARK:"#1441A8",REACT_APP_DARKER:"#0D2A6E"}).REACT_APP_CUSTOM_SMART_PROMOTE_ID||"proforma"!==(null===N||void 0===N?void 0:N.id)&&"invoice"!==(null===N||void 0===N?void 0:N.id)&&"vat_invoice"!==(null===N||void 0===N?void 0:N.id)&&"cash_transaction"!==(null===N||void 0===N?void 0:N.id)||Object(n.a)((null===(Mo=Bo)||void 0===Mo?void 0:Mo.docParticulars)||[]).forEach(function(){var o=Object(a.a)(r.a.mark((function o(t){var d;return r.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(null===t||void 0===t||!t.inventoryItemData){o.next=3;break}return o.next=3,E.b.collection("company").doc(null===D||void 0===D?void 0:D.id).collection("inventory").doc(null===t||void 0===t||null===(d=t.inventoryItemData)||void 0===d?void 0:d.id).get().then(function(){var o=Object(a.a)(r.a.mark((function o(a){var d,l,c,u,s,A,_,T,v,P,m,R,p,C,O,b,I,h,f,y,g,w,L,V,B,M,x,k,U;return r.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(!a.exists){o.next=22;break}return v=(null===a||void 0===a||null===(d=a.data())||void 0===d?void 0:d.allInventoryItemTransactions)||[],P=-1,v.length>0&&(P=v.findIndex((function(o){return o.docString===e&&(null===o||void 0===o?void 0:o.docType)===(null===N||void 0===N?void 0:N.id)}))),m=Number((null===a||void 0===a||null===(l=a.data())||void 0===l?void 0:l.qtySold)||0),R=Number((null===a||void 0===a||null===(c=a.data())||void 0===c?void 0:c.qtyRemaining)||0),p=Number((null===t||void 0===t?void 0:t.rowQty)||0),C=Number((null===a||void 0===a||null===(u=a.data())||void 0===u?void 0:u.totalAmountReceivedWithoutVAT)||0),O=Number((null===a||void 0===a||null===(s=a.data())||void 0===s?void 0:s.totalAmountReceivedWithVAT)||0),b=0,null!==a&&void 0!==a&&null!==(A=a.data())&&void 0!==A&&A.invApplyVat&&(b=1.15*Number((null===t||void 0===t?void 0:t.rowDiscountedAmount)||(null===t||void 0===t?void 0:t.rowAmount)||0)),P>-1&&(g=Number((null===(I=v[P])||void 0===I?void 0:I.itemQtySold)||0),R+=g,m-=g,C-=Number((null===(h=v[P])||void 0===h?void 0:h.rowDiscountedAmount)||(null===(f=v[P])||void 0===f?void 0:f.rowAmount)||0),O-=Number((null===(y=v[P])||void 0===y?void 0:y.rowAmountWithVAT)||0)),C+=Number((null===t||void 0===t?void 0:t.rowDiscountedAmount)||(null===t||void 0===t?void 0:t.rowAmount)||0),O+=b,w=R-p,L=p+m,V=Object(n.a)((null===a||void 0===a||null===(_=a.data())||void 0===_?void 0:_.allInventoryItemTransactions)||[]),P>-1?(V=Object(n.a)(v||[]))[P]=Object(i.a)(Object(i.a)({},V[P]),{},{actualRemainingStockAmount:w,itemQtySold:p,rowAmount:(null===t||void 0===t?void 0:t.rowAmount)||0,rowDiscountAmount:(null===t||void 0===t?void 0:t.rowDiscountAmount)||0,rowDiscountedAmount:(null===t||void 0===t?void 0:t.rowDiscountedAmount)||0,rowAmountWithVAT:b,rowUnitPrice:(null===t||void 0===t?void 0:t.rowUnitPrice)||0}):(V=Object(n.a)(v||[])).push({documentNumber:null===(B=Bo)||void 0===B?void 0:B.id,docString:null===(M=Bo)||void 0===M?void 0:M.docString,docCustomIdNumber:null===(x=Bo)||void 0===x?void 0:x.docCustomIdNumber,docTitle:null===(k=Bo)||void 0===k?void 0:k.docTitle,docType:null===N||void 0===N?void 0:N.id,docDate:new Date,itemId:null===t||void 0===t||null===(U=t.inventoryItemData)||void 0===U?void 0:U.id,rowAmount:(null===t||void 0===t?void 0:t.rowAmount)||0,rowDiscountAmount:(null===t||void 0===t?void 0:t.rowDiscountAmount)||0,rowDiscountedAmount:(null===t||void 0===t?void 0:t.rowDiscountedAmount)||0,rowAmountWithVAT:b,rowUnitPrice:(null===t||void 0===t?void 0:t.rowUnitPrice)||0}),o.next=20,E.b.collection("company").doc(null===D||void 0===D?void 0:D.id).collection("inventory").doc(null===t||void 0===t||null===(T=t.inventoryItemData)||void 0===T?void 0:T.id).set({totalAmountReceivedWithoutVAT:Number(C||0).toFixed(2),totalAmountReceivedWithVAT:Number(O||0).toFixed(2),qtySold:L||0,qtyRemaining:w||0,allInventoryItemTransactions:V||[]},{merge:!0}).then((function(){S("Stock updated successfully")})).catch((function(o){S("Error occured while updating quantity of inventory item: ".concat(null===o||void 0===o?void 0:o.message),{variant:"error"})}));case 20:o.next=23;break;case 22:S("Stock could not be updated as item could not be found, please check inventory",{variant:"error"});case 23:case"end":return o.stop()}}),o)})));return function(t){return o.apply(this,arguments)}}());case 3:case"end":return o.stop()}}),o)})));return function(t){return o.apply(this,arguments)}}()),o.next=11,E.b.collection("company").doc(I).collection(null===t||void 0===t?void 0:t.documentTypeId).doc(e).set(Object(i.a)({},Bo),{merge:!0}).then((function(){S("".concat(null===t||void 0===t?void 0:t.documentTypeTitle," updated successfully")),R&&R(!0),O(Object(u.d)(!1))})).catch((function(o){S("Error occured while updating ".concat(null===t||void 0===t?void 0:t.documentTypeTitle,": ").concat(null===o||void 0===o?void 0:o.message),{variant:"error"}),O(Object(u.d)(!1))}));case 11:case"end":return o.stop()}}),o)}))),fo.apply(this,arguments)}return Object(P.jsx)(P.Fragment,{children:Object(P.jsx)(l.a,{variant:"contained",color:"primary",onClick:function(){return function(){return Do.apply(this,arguments)}()},fullWidth:!0,disabled:!(null!==e&&void 0!==e&&e.docTotal),children:"Update ".concat(null===N||void 0===N?void 0:N.title)})})}}}]);
//# sourceMappingURL=67.26c7d48f.chunk.js.map